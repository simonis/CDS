<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">

  <head>
    <meta charset="utf-8" />

    <title>Class Data Sharing - Sharing Economy in the HotSpot VM</title>

    <meta name="description" content="Class Data Sharing in the HotSpot VM" />
    <meta name="author" content="Volker H. Simonis" />

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" />

    <link rel="stylesheet" href="reveal.js/css/reveal.css" />
    <link rel="stylesheet" href="reveal.js/css/theme/joker2017.css" id="theme" />
    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="reveal.js/lib/css/monokai_sublime.css" />
    <!-- Local overrides -->
    <link rel="stylesheet" href="css/local.css" />

    <style type="text/css">
.reveal table th,
.reveal table td {
  text-align: left;
  padding: 0.2em 0.5em 0.2em 0.5em; }
.reveal table th {
  border-bottom: 4px solid; }
.reveal table td {
  border-bottom: 2px solid; }
    </style>

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <!--[if lt IE 9]>
    <script src="reveal.js/lib/js/html5shiv.js"></script>
    <![endif]-->

    <!--
      Issue #1105: Keyboard shortcut to skip forward/back over fragments #1173
      https://github.com/hakimel/reveal.js/pull/1173
    -->
  </head>

<!--
;; indent block of text
;; C-u <number> C-x <TAB>



;; select this code and do 'M-x eval-region'
(defun make-fragment (p1 p2)
  "Wraps the selection into 'fragment' <span>s and quotes '&', '<' and '>'."
  (interactive "r")
  (setq inputStr (buffer-substring-no-properties p1 p2))
  (setq inputStr (replace-regexp-in-string "&" "&amp;" inputStr))
  (setq inputStr (replace-regexp-in-string "<" "&lt;" inputStr))
  (setq inputStr (replace-regexp-in-string ">" "&gt;" inputStr))
  (setq resultStr (concat "<span class=\"fragment\">" (concat inputStr "</span>")))
  (delete-region p1 p2)
  (insert resultStr)
)
(defun make-fragment-simple (p1 p2)
  "Wraps the selection into 'fragment' <span>s without any quoting."
  (interactive "r")
  (setq inputStr (buffer-substring-no-properties p1 p2))
  (setq resultStr (concat "<span class=\"fragment\">" (concat inputStr "</span>")))
  (delete-region p1 p2)
  (insert resultStr)
)
(defun quote-fragment (p1 p2)
  "Quotes '&', '<' and '>'."
  (interactive "r")
  (setq inputStr (buffer-substring-no-properties p1 p2))
  (setq inputStr (replace-regexp-in-string "&" "&amp;" inputStr))
  (setq inputStr (replace-regexp-in-string "<" "&lt;" inputStr))
  (setq inputStr (replace-regexp-in-string ">" "&gt;" inputStr))
  (delete-region p1 p2)
  (insert inputStr)
)

(global-set-key (kbd "C-f") 'make-fragment)
(global-set-key (kbd "C-S-f") 'make-fragment-simple)
(global-set-key (kbd "C-S-q") 'quote-fragment)
;; revert key-binding
;; (global-set-key (kbd "C-f") 'forward-char)
;;
;; use 'C-h k <keystroke>' to find out what <keystroke> is currently bound to

;; (vhs) The following is required to make 'C-c C-t' insert <code> tags without
;; newlines. 'sgml-tag-alist' is the "file-local" version of 'html-tag-alist'
(add-to-list 'html-tag-alist '("code"))
(add-to-list 'sgml-tag-alist '("code"))

-->

  <body>

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">

        <section data-background="images/geecon_slide-01.jpg">
          <h1 style="color:white; text-shadow: -1px -1px 3px #000, 1px -1px 3px #000, -1px  1px 3px #000, 1px  1px 3px #000;">Class Data Sharing</h1>
          <h3 style="color:white;">Sharing Economy in the HotSpot VM</h3>
          <p>
            <small style="color:black;">Volker Simonis, SAP / <a  style="color:black;" href="mailto:volker.simonis@gmail.com">volker.simonis@gmail.com</a></small>
          </p>
        </section>

        <section data-background="images/geecon_slide-03.jpg">

          <h3 style="text-transform: none;"><a  style="color: black;" href="https://simonis.github.io/GeeCON2018/CDS">https://simonis.github.io/GeeCON2018/CDS</a></h3>

        </section>

        <section>

          <section>
            <h2>Native vs. Java Applications</h2>

            <div width="100%" style="position: relative; margin: 0 0 0 0px;">
              <div class="" style="position: static; width: 100%">
                <object data="images/Native_vs_Java_1.svg" type="image/svg+xml"
                        style="width: 70%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="1" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/Native_vs_Java_2.svg" type="image/svg+xml"
                        style="width: 70%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="2" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/Native_vs_Java_3.svg" type="image/svg+xml"
                        style="width: 70%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="3" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/Native_vs_Java_4.svg" type="image/svg+xml"
                        style="width: 70%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="4" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/Native_vs_Java_5.svg" type="image/svg+xml"
                        style="width: 70%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="5" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/Native_vs_Java_6.svg" type="image/svg+xml"
                        style="width: 70%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="6" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/Native_vs_Java_7.svg" type="image/svg+xml"
                        style="width: 70%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="7" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/Native_vs_Java_8.svg" type="image/svg+xml"
                        style="width: 70%;">&nbsp;</object>
              </div>
            </div>
          </section>

          <section>
            <h2>Introducing: CDS &amp; AOT</h2>

            <div width="100%" style="position: relative; margin: 0 0 0 0px;">
              <div class="" style="position: static; width: 100%">
                <object data="images/Java_CDS_AOT_1.svg" type="image/svg+xml"
                        style="width: 70%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="1" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/Java_CDS_AOT_2.svg" type="image/svg+xml"
                        style="width: 70%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="2" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/Java_CDS_AOT_3.svg" type="image/svg+xml"
                        style="width: 70%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="3" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/Java_CDS_AOT_4.svg" type="image/svg+xml"
                        style="width: 70%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="4" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/Java_CDS_AOT_5.svg" type="image/svg+xml"
                        style="width: 70%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="5" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/Java_CDS_AOT_6.svg" type="image/svg+xml"
                        style="width: 70%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="6" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/Java_CDS_AOT_7.svg" type="image/svg+xml"
                        style="width: 70%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="7" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/Java_CDS_AOT_8.svg" type="image/svg+xml"
                        style="width: 70%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="8" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/Java_CDS_AOT_9.svg" type="image/svg+xml"
                        style="width: 70%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="9" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/Java_CDS_AOT_10.svg" type="image/svg+xml"
                        style="width: 70%;">&nbsp;</object>
              </div>
            </div>
          </section>

          <section>
            <h2>Class Data Sharing &amp; Ahead of Time Compilation</h2>

            <ul>
              <li>CDS: Cache preprocessed class metadata on disc</li>
              <li>AOT: Cache precompiled Java code on disc</li>
              <li>Improve startup performance</li>
              <li>Reduce memory footprint</li>
            </ul>
          </section>
        </section>


        <section class="demo">
          <h2>Short History of CDS in the HotSpot VM</h2>

          <ul>
            <li class="fragment">Introduced 2004 with <a href="https://docs.oracle.com/javase/1.5.0/docs/guide/vm/class-data-sharing.html">JDK 1.5</a>
              <ul>
                <li>Only for Client VM, only Serial GC</li>
                <li>Only system classes</li>
              </ul>
            </li>
            <li class="fragment">Part of the initial OpenJDK 6/7 contribution</li>
            <li class="fragment">Since OpenJDK 9 / <a href="https://docs.oracle.com/javase/9/vm/class-data-sharing.htm#JSJVM-GUID-0260F857-A70E-4399-A1DF-A5766BE33285">JDK 9</a>:
              <ul>
                <li>Support for Server VM</li>
                <li>Support for G1, Serial, Parallel and ParallelOld GCs</li>
                <li>Support for shared strings (only with G1, non-Windows)</li>
                <li>Support for application classes
                  (<a href="https://docs.oracle.com/javase/9/tools/java.htm#JSWOR-GUID-31503FCE-93D0-4175-9B4F-F6A738B2F4C4">commercial Oracle JDK feature</a>)</li>
              </ul>
            </li>
            <li class="fragment">Coming with OpenJDK 10:
              <ul>
                <li><a href="http://openjdk.java.net/jeps/31">JEP 310: Application Class-Data Sharing</a></li>
              </ul>
            </li>
          </ul>
        </section>

        <section class="demo">

          <section class="demo">

            <h2>CDS Basics</h2>

            <pre class="big noshadow" style="height:100%; margin: 0;" data-trim="true">
              <code class="terminal" data-trim="true" data-noescape="true" style="height:100%;">
$ java <span class="fragment highlight-current-border" data-fragment-index="0">-Xshare:dump</span><span class="fragment" data-fragment-index="1">
<span class="fragment highlight-current-border" data-fragment-index="2">Loading classes to share ...</span> <span class="fragment" data-fragment-index="2">  // from JAVA_HOME/lib/classlist</span>
total    :  <span class="fragment highlight-current-border" data-fragment-index="12">18.422.144</span> [100.0% ]<span class="fragment" data-fragment-index="12"> // to JAVA_HOME/lib/server/classes.jsa</span>
$ </span><span class="fragment">java <span class="fragment highlight-current-border">-Xshare:on</span> io.simonis.HelloCDS</span>
<span class="fragment">HelloCDS
$ </span><span class="fragment">java -Xshare:on <span class="fragment highlight-current-border">-Xlog:class+load</span> io.simonis.HelloCDS
</span><span class="fragment">[class,load] java.lang.Object <span class="fragment highlight-current-border">source: shared objects file</span>
...</span>
<span class="fragment">[class,load] j.i.l.URLClassPath$FileLoader <span class="fragment highlight-current-border">source: jrt:/java.base</span>
...</span>
<span class="fragment">[class,load] io.simonis.HelloCDS2 source: <span class="fragment highlight-current-border">file:/examples/bin/</span>
HelloCDS</span>
<span class="fragment">$ java -Xshare:on -Xlog:class+load io.simonis.HelloCDS \
      | <span class="fragment highlight-current-border">grep "shared objects file"</span> | wc</span>
    <span class="fragment">477    2862   40977
$ </span><span class="fragment">java -Xshare:on -Xlog:class+load io.simonis.HelloCDS \
      | <span class="fragment highlight-current-border">grep -v "shared objects file"</span> | wc</span>
      <span class="fragment">5      17     424</span>
              </code>
            </pre>
          </section>

          <section class="demo">

            <h2>CDS Basics - Performance</h2>

            <pre class="big noshadow" style="height:100%; margin: 0;" data-trim="true">
              <code class="terminal" data-trim="true" data-noescape="true" style="height:100%;">
$ time -f "%e sec\n" java <span class="fragment highlight-current-border">-Xshare:off</span> io.simonis.HelloCDS
<span class="fragment">Hello CDS
0.162 sec
$</span> <span class="fragment">time -f "%e sec\n" java <span class="fragment highlight-current-border">-Xshare:on</span>  io.simonis.HelloCDS          </span>
<span class="fragment">Hello CDS
0.148 sec</span>
              </code>
            </pre>

            <p class="fragment">About 9% overall performance improvement</p>

            <pre class="big noshadow fragment" style="height:100%; margin: 0;" data-trim="true">
              <code class="terminal" data-trim="true" data-noescape="true" style="height:100%;">
$ java <span class="fragment highlight-current-border">-Xshare:off</span> <span class="fragment highlight-current-border">-Xlog:class+load</span> io.simonis.HelloCDS
<span class="fragment">[0,164s][class,load] io.simonis.HelloCDS source: file:/examples/bin
$</span> <span class="fragment">java <span class="fragment highlight-current-border">-Xshare:on</span>  -Xlog:class+load io.simonis.HelloCDS</span>
<span class="fragment">[0,143s][class,load] io.simonis.HelloCDS source: file:/examples/bin</span>
              </code>
            </pre>

            <p class="fragment">Application class loads about 13% faster</p>
          </section>

        </section>


        <section class="demo">

          <section class="demo">

            <h2>CDS &amp; AppCDS with <a href="http://jruby.org/">JRuby 9.1.16</a></h2>

            <pre class="big noshadow" style="height:100%; margin: 0;" data-trim="true">
              <code class="terminal" data-trim="true" data-noescape="true" style="height:100%;">
$ export VERIFY_JRUBY=1
$ <span class="fragment">JAVA_OPTS="<span class="fragment highlight-current-border">-Xshare:on</span> \
             <span class="fragment highlight-current-border">-Xlog:class+load:file=jruby_cds.classtrace</span>" \
  <span class="fragment highlight-current-border">jruby --dev -e 1</span>
$</span> <span class="fragment">wc jruby.classtrace</span>
  <span class="fragment"><span class="fragment highlight-border">6621</span>   28511 806148 jruby.classtrace
$</span> <span class="fragment">grep "<span class="fragment highlight-current-border">shared objects file</span>" jruby.classtrace | wc</span>
   <span class="fragment"><span class="fragment highlight-border">1008</span>    6048  89449
$</span> <span class="fragment">JAVA_OPTS="<span class="fragment highlight-current-border">-XX:DumpLoadedClassList=jruby_cds.cls</span>" \
  jruby --dev -e 1
$</span> <span class="fragment">wc jruby_cds.cls</span>
   <span class="fragment"><span class="fragment highlight-border">1480</span>   1480 51716 jruby_cds.cls
$</span> <span class="fragment">JAVA_OPTS="-XX:DumpLoadedClassList=jruby_appcds.cls \
                 <span class="fragment highlight-current-border">-XX:+UseAppCDS</span>" \
  jruby --dev -e 1
$</span> <span class="fragment">wc jruby_appcds.cls</span>
   <span class="fragment"><span class="fragment highlight-border">6504</span>   6504 262466 jruby_appcds.cls</span>
              </code>
            </pre>
          </section>

          <section class="demo">

            <h2>CDS &amp; AppCDS with <a href="http://jruby.org/">JRuby 9.1.16</a></h2>

            <pre class="big noshadow" style="height:100%; margin: 0;" data-trim="true">
              <code class="terminal" data-trim="true" data-noescape="true" style="height:100%;">
$ JAVA_OPTS="<span class="fragment highlight-current-border">-Xshare:dump -XX:+UseAppCDS</span> \
             <span class="fragment highlight-current-border">-XX:SharedClassListFile=jruby_appcds.cls</span> \
             -XX:+UnlockDiagnosticVMOptions \
             <span class="fragment highlight-current-border">-XX:SharedArchiveFile=jruby_appcds.jsa</span>" \
  jruby --dev -e 1
$<span class="fragment"> ll jruby_appcds.jsa</span>
<span class="fragment">-r--r----- <span class="fragment highlight-current-border">58.994.688</span> MÃ¤r  3 23:01 jruby_appcds.jsa
$</span> <span class="fragment">JAVA_OPTS="<span class="fragment highlight-current-border">-Xshare:on -XX:+UseAppCDS</span> \
             -XX:+UnlockDiagnosticVMOptions \
             <span class="fragment highlight-current-border">-XX:SharedArchiveFile=jruby_appcds.jsa</span> \
             <span class="fragment highlight-current-border">-Xlog:class+load:file=jruby_appcds.clstrace</span>" \
  jruby --dev -e 1
$</span><span class="fragment"> wc jruby_appcds.clstrace</span>
  <span class="fragment"><span class="fragment highlight-border">6591</span>   39257 630637 jruby_appcds.clstrace
$</span><span class="fragment"> grep "shared objects " jruby_appcds.clstrace | wc</span>
   <span class="fragment"><span class="fragment highlight-border">6447</span>   38682  615284</span>

              </code>
            </pre>
          </section>

          <section class="demo">

            <h2>AppCDS Performance with <a href="http://jruby.org/">JRuby 9.1.16</a></h2>

            <pre class="big noshadow" style="height:100%; margin: 0;" data-trim="true">
              <code class="terminal" data-trim="true" data-noescape="true" style="height:100%;">
$ JAVA_OPTS="<span class="fragment highlight-current-border">-Xshare:on -XX:+UseAppCDS</span> \
             -XX:+UnlockDiagnosticVMOptions \
             -XX:SharedArchiveFile=/tmp/jruby_appcds.jsa" \
  /usr/bin/time -f "%e sec\n" ./bin/jruby --dev -e 1
<span class="fragment"><mark class="border">2.02 sec</mark>
$</span> <span class="fragment">JAVA_OPTS="<span class="fragment highlight-current-border">-Xshare:off</span> -XX:+UseAppCDS \
             -XX:+UnlockDiagnosticVMOptions \
             -XX:SharedArchiveFile=/tmp/jruby_appcds.jsa" \
  /usr/bin/time -f "%e sec\n" ./bin/jruby --dev -e 1</span>
<span class="fragment"><mark class="border">3.05 sec</mark></span>
              </code>
            </pre>

            <p class="fragment">About <b>30%</b> startup performance improvement!!!</p>

            <p class="fragment"><a href="https://twitter.com/headius/status/968988277071020032">Charly is quite happy about this :)</a></p>
          </section>
        </section>

        <section class="demo">

          <section class="demo">

            <h2>CDS &amp; AppCDS with <a href="https://tomcat.apache.org/download-90.cgi">Tomcat 9</a> &amp; <a href="http://naver.github.io/ngrinder/">nGrinder</a></h2>

            <pre class="big noshadow" style="height:100%; margin: 0;" data-trim="true">
              <code class="terminal" data-trim="true" data-noescape="true" style="height:100%;">
$ CATALINA_OPTS="<span class="fragment highlight-current-border">-Xshare:on</span> \
                 <span class="fragment highlight-current-border">-Xlog:class+load:file=/tmp/tomcat.classtrace</span>" \
  catalina.sh start
$ <span class="fragment">wc /tmp/tomcat.classtrace</span>
  <span class="fragment"><span class="fragment highlight-border">12644</span>   50575 2075264 /tmp/tomcat.classtrace
$</span> <span class="fragment">grep "<span class="fragment highlight-current-border">shared objects file</span>" /tmp/tomcat.classtrace | wc</span>
   <span class="fragment"><span class="fragment highlight-border">1156</span>    6936  103052
$</span> <span class="fragment">CATALINA_OPTS="<span class="fragment highlight-current-border">-XX:DumpLoadedClassList=/tmp/tomcat.cls</span>" \
  catalina.sh start
$</span> <span class="fragment">wc /tmp/tomcat.cls</span>
   <span class="fragment"><span class="fragment highlight-border">3261</span>   3261 125647 /tmp/tomcat.cls
$</span> <span class="fragment">CATALINA_OPTS="-XX:DumpLoadedClassList=/tmp/tomcat_appcds.cls \
                 <span class="fragment highlight-current-border">-XX:+UseAppCDS</span>" \
  catalina.sh start
$</span> <span class="fragment">wc /tmp/tomcat_appcds.cls</span>
   <span class="fragment"><span class="fragment highlight-border">3520</span>   3520 133431 /tmp/tomcat_appcds.cls</span>
              </code>
            </pre>
          </section>

          <section class="demo">

            <h2>CDS &amp; AppCDS with <a href="https://tomcat.apache.org/download-90.cgi">Tomcat 9</a> &amp; <a href="http://naver.github.io/ngrinder/">nGrinder</a></h2>

            <pre class="big noshadow" style="height:100%; margin: 0;" data-trim="true">
              <code class="terminal" data-trim="true" data-noescape="true" style="height:100%;">
$ CATALINA_OPTS="<span class="fragment highlight-current-border">-Xshare:dump -XX:+UseAppCDS</span> \
                 <span class="fragment highlight-current-border">-XX:SharedClassListFile=/tmp/tomcat_appcds.cls</span> \
                 -XX:+UnlockDiagnosticVMOptions \
                 <span class="fragment highlight-current-border">-XX:SharedArchiveFile=/tmp/tomcat_appcds.jsa</span>" \
  catalina.sh start
$<span class="fragment"> ll /tmp/tomcat_appcds.jsa</span>
<span class="fragment">-r--r----- <span class="fragment highlight-current-border">49.979.392</span> Feb  2 23:57 /tmp/tomcat_appcds.jsa
$</span> <span class="fragment">CATALINA_OPTS="<span class="fragment highlight-current-border">-Xshare:on -XX:+UseAppCDS</span> \
                 -XX:+UnlockDiagnosticVMOptions \
                 <span class="fragment highlight-current-border">-XX:SharedArchiveFile=/tmp/tomcat_appcds.jsa</span> \
                 <span class="fragment highlight-current-border">-Xlog:class+load:file=/tmp/tomcat_appcds.clstrace</span>" \
  catalina.sh start
$</span><span class="fragment"> wc /tmp/tomcat_appcds.clstrace</span>
  <span class="fragment"><span class="fragment highlight-border">12645</span>   57615 2088947 /tmp/tomcat_appcds.clstrace
$</span><span class="fragment"> grep "shared objects " /tmp/tomcat_appcds.clstrace | wc</span>
   <span class="fragment"><span class="fragment highlight-border">3518</span>   21108  327511</span>

              </code>
            </pre>
          </section>

        </section>

        <section class="demo">

          <section class="demo">

            <h2>AppCDS with Custom Class Loaders</h2>

            <ul>
              <li class="fragment">OpenJDK 10: <a href="http://openjdk.java.net/jeps/31">JEP 310 - Application Class-Data Sharing</a></li>
              <li class="fragment">Supports sharing of classes loaded by the application class loader <br/> (a.k.a. system class loader) with <code>-XX:+UseAppCDS</code></li>
              <li class="fragment"><em>Supports sharing of classes loaded by custom class loaders</em></li>
              <li class="fragment">Unfortunately <code>-XX:DumpLoadedClassList=.. -XX:+UseAppCDS</code> <br/> doesn't dump classes loaded by custom class loaders</li>
            </ul>
          </section>

          <section class="demo">

            <h2>AppCDS - Class List Format</h2>

            <ul>
              <li><code>-XX:DumpLoadedClassList=...</code> creates a trivial class list:<br/>

                <pre class="big noshadow" style="height:100%; margin: 0;" data-trim="true">
                  <code class="terminal" data-trim="true" data-noescape="true" style="height:100%;">
$ cat /tmp/tomcat_appcds.cls
java/lang/Object
java/lang/String                                          
...
<span class="fragment highlight-current-border" data-fragment-index="1">org/apache/catalina/startup/Bootstrap</span>
                  </code>
                </pre>
              </li>
              <li class="fragment" data-fragment-index="2">The format for classes loaded by custom class loaders isn't specified<br/> anywhere, except in
                <a href="http://hg.openjdk.java.net/jdk/jdk/file/tip/src/hotspot/share/classfile/classListParser.cpp">classListParser.cpp</a><br/>

                <pre class="big noshadow fragment" data-fragment-index="3" style="height:100%; margin: 0;" data-trim="true">
                  <code class="terminal" data-trim="true" data-noescape="true" style="height:100%;">
CLASSNAME [ ID ]?
CLASSNAME ID <span class="fragment highlight-current-border" data-fragment-index="5">super: ID</span> [ <span class="fragment highlight-current-border" data-fragment-index="5">interface: [ ID ]+</span> ]? <span class="fragment highlight-current-border" data-fragment-index="4">source: URL</span>
                  </code>
                </pre>
              </li>
            </ul>
          </section>

          <section class="demo">

            <h2>Creating a Class List for Custom Loaders</h2>

            <ul>
              <li><code>-Xlog:class+load<span class="fragment highlight-current-border" data-fragment-index="1">=debug</span></code> has all the information we need:<br/>

                <pre class="big noshadow fragment" data-fragment-index="2" style="height:100%; margin: 0;" data-trim="true">
                  <code class="terminal" data-trim="true" data-noescape="true" style="height:100%;">
$ CATALINA_OPTS="-Xlog:class+load=debug" catalina.sh start
<span class="fragment" data-fragment-index="3">[info ] <span class="fragment highlight-current-border" data-fragment-index="4">java.lang.Object</span> <span class="fragment highlight-current-border" data-fragment-index="4">source: jrt:/java.base</span>
[debug]  klass: <span class="fragment highlight-current-border" data-fragment-index="9">0x100000eb0</span> super: 0x000000000 <span class="fragment highlight-current-border" data-fragment-index="5">loader: [NULL class loader]</span>
....
[info ] <span class="fragment highlight-current-border" data-fragment-index="6">java.sql.Timestamp</span> <span class="fragment highlight-current-border" data-fragment-index="6">source: jrt:/java.sql</span>
[debug]  klass: 0x100096c30 super: 0x100091a00 \
         <span class="fragment highlight-current-border" data-fragment-index="7">loader: [0xff0172600 a 'ClassLoaders$PlatformClassLoader']</span>
....
[info ] <span class="fragment highlight-current-border" data-fragment-index="8">org.apache.catalina.Server</span> <span class="fragment highlight-current-border" data-fragment-index="8">source: file:catalina.jar</span>
[debug]  klass: 0x1000e6410 <span class="fragment highlight-current-border" data-fragment-index="9">super: 0x100000eb0</span> <span class="fragment highlight-current-border" data-fragment-index="10">interfaces: 0x1000e6238</span> \
         <span class="fragment highlight-current-border" data-fragment-index="11">loader: [0xff0310fb0 a 'java/net/URLClassLoader']</span></span>
                  </code>
                </pre>
              </li>
              <li class="fragment" data-fragment-index="12">From this output we can easily create:<br/>

                <pre class="big noshadow" style="height:100%; margin: 0;" data-trim="true">
                  <code class="terminal" data-trim="true" data-noescape="true" style="height:100%;">
<span class="fragment highlight-current-border" data-fragment-index="13">java/lang/Object</span>           <span class="fragment highlight-current-border" data-fragment-index="13">id: 0x100000eb0</span>
<span class="fragment highlight-current-border" data-fragment-index="14">java/sql/Timestamp </span>        <span class="fragment highlight-current-border" data-fragment-index="14">id: 0x100096c30</span>
<span class="fragment highlight-current-border" data-fragment-index="15">org/apache/catalina/Server</span> <span class="fragment highlight-current-border border-no-bottom" data-fragment-index="15">id: 0x1000e6410 super: 0x100000eb0 \        </span>
                           <span class="fragment highlight-current-border border-no-top   " data-fragment-index="15">interfaces: 0x1000e6238 source: catalina.jar</span>
                  </code>
                </pre>
              </li>
            </ul>
          </section>

          <section class="demo">

            <h2><code><a href="https://github.com/simonis/cl4cds">cl4cds</a></code></h2>

            <code>cl4cds</code> converts a class log into a CDS class list:

                <pre class="big noshadow" style="height:100%; margin: 0;" data-trim="true">
                  <code class="terminal" data-trim="true" data-noescape="true" style="height:100%;">
$ CATALINA_OPTS="<span class="fragment highlight-current-border">-Xlog:class+load=debug:file=tomcat_dbg.clstrace</span>" \
  catalina.sh start
$ <span class="fragment"><span class="fragment highlight-current-border">java io.simonis.cl4cds</span> <span class="fragment highlight-current-border">tomcat_dbg.clstrace</span> <span class="fragment highlight-current-border">tomcat_cl4cds.cls</span>
$</span><span class="fragment"> CATALINA_OPTS="<span class="fragment highlight-current-border">-Xshare:dump</span> -XX:+UseAppCDS \
                 <span class="fragment highlight-current-border">-XX:SharedClassListFile=tomcat_cl4cds.cls</span> \
                 -XX:+UnlockDiagnosticVMOptions \
                 <span class="fragment highlight-current-border">-XX:SharedArchiveFile=tomcat_cl4cds.jsa</span>" \
  catalina.sh start
$</span><span class="fragment"> ll tomcat_cl4cds.jsa</span>
<span class="fragment">-r--r----- 1 <span class="fragment highlight-border">102.305.792</span> Feb  3 01:48 tomcat_cl4cds.jsa
$</span><span class="fragment"> CATALINA_OPTS="<span class="fragment highlight-current-border">-Xshare:on</span> -XX:+UseAppCDS \
                 -XX:+UnlockDiagnosticVMOptions \
                 <span class="fragment highlight-current-border">-XX:SharedArchiveFile=tomcat_cl4cds.jsa</span> \
                 <span class="fragment highlight-current-border">-Xlog:class+load:file=tomcat_cl4cds.clstrace</span>" \
  catalina.sh start
$</span><span class="fragment"> wc tomcat_cl4cds.clstrace</span>
  <span class="fragment"><span class="fragment highlight-border">12644</span>   69335 1531203 tomcat_cl4cds.clstrace
$</span><span class="fragment"> grep "shared objects " tomcat_cl4cds.clstrace | wc</span>
   <span class="fragment"><span class="fragment highlight-border">9380</span>   56280  963418</span>
                  </code>
                </pre>
          </section>

<span style="visibility: hidden;">

Create HotSpot CDS archive in docker container:
===============================================
docker run -v /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples:/examples -p 8091:8080 -it - -rm -m 500m cds_demo_ojdk:latest /bin/bash

/examples/tomcat_measure.sh 1 "-XX:TieredStopAtLevel=1 -XX:CICompilerCount=1 -Xmx64m -Xms64m -Xlog:class+load=debug:file=/tmp/tomcat_dbg.clstrace"

java -cp /examples/cl4cds-1.0.0-SNAPSHOT.jar io.simonis.cl4cds /tmp/tomcat_dbg.clstrace /tmp/tomcat_cl4cds.cls

/examples/tomcat_measure.sh 1 "-XX:TieredStopAtLevel=1 -XX:CICompilerCount=1 -Xmx64m -Xms64m -XX:+UseG1GC -Xshare:dump -XX:+UseAppCDS -XX:SharedClassListFile=/tmp/tomcat_cl4cds.cls -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/tmp/tomcat_cl4cds.jsa"

Number of classes 9694
    instance classes   =  9602
    obj array classes  =    84
    type array classes =     8
Updating ConstMethods ... done. 
Removing unshareable information ... done. 
Scanning all metaspace objects ... 
Allocating RW objects ... 
Allocating RO objects ... 
Relocating embedded pointers ... 
Relocating external roots ... 
Dumping symbol table ...
Dumping String objects to closed archive heap region ...
Dumping objects to open archive heap region ...
Relocating SystemDictionary::_well_known_klasses[] ... 
Removing java_mirror ... done. 
mc  space:     13264 [  0.0% of total] out of     16384 bytes [ 81.0% used] at 0x0000000800000000
rw  space:  22873296 [ 22.1% of total] out of  22876160 bytes [100.0% used] at 0x0000000800004000
ro  space:  40262480 [ 38.9% of total] out of  40263680 bytes [100.0% used] at 0x00000008015d5000
md  space:      6160 [  0.0% of total] out of      8192 bytes [ 75.2% used] at 0x0000000803c3b000
od  space:  36699784 [ 35.4% of total] out of  36700160 bytes [100.0% used] at 0x0000000803c3d000
st0 space:    417792 [  0.4% of total] out of    417792 bytes [100.0% used] at 0x00000000ff400000
st1 space:   3145728 [  3.0% of total] out of   3145728 bytes [100.0% used] at 0x00000000ff500000
oa0 space:    176128 [  0.2% of total] out of    176128 bytes [100.0% used] at 0x00000000ff300000
total    : 103594632 [100.0% of total] out of 103604224 bytes [100.0% used]


Create HotSpot CDS archive in docker container (with extra string/symbol file):
-------------------------------------------------------------------------------
docker run -v /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples:/examples -p 8091:8080 -it - -rm -m 500m cds_demo_ojdk:latest /bin/bash

/examples/tomcat_measure.sh 1 "-XX:TieredStopAtLevel=1 -XX:CICompilerCount=1 -Xmx64m -Xms64m -Xlog:class+load=debug:file=/tmp/tomcat_dbg.clstrace"

java -cp /examples/cl4cds-1.0.0-SNAPSHOT.jar io.simonis.cl4cds /tmp/tomcat_dbg.clstrace /tmp/tomcat_cl4cds.cls

jcmd `pgrep -f tomcat` VM.stringtable -verbose > /examples/docker_ojdk/tomcat_sa/stringtable.jcmd
jcmd `pgrep -f tomcat` VM.symboltable -verbose > /examples/docker_ojdk/tomcat_sa/symboltable.jcmd

combine stringtable.jcmd and symboltable.jcmd into string_symbol.cfg like this:

VERSION: 1.0
@SECTION: String
[stringtable.jcmd]
@SECTION: Symbol
[symboltable.jcmd]

/examples/tomcat_measure.sh 1 "-XX:TieredStopAtLevel=1 -XX:CICompilerCount=1 -Xmx64m -Xms64m -XX:+UseG1GC -Xshare:dump -XX:+UseAppCDS -XX:SharedClassListFile=/tmp/tomcat_cl4cds.cls -XX:SharedArchiveConfigFile=/examples/docker_ojdk/tomcat_sa/string_symbol.cfg -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/tmp/tomcat_cl4cds.jsa"

Rewriting and linking classes: done
Number of classes 9682
    instance classes   =  9590
    obj array classes  =    84
    type array classes =     8
Updating ConstMethods ... done. 
Removing unshareable information ... done. 
Scanning all metaspace objects ... 
Allocating RW objects ... 
Allocating RO objects ... 
Relocating embedded pointers ... 
Relocating external roots ... 
Dumping symbol table ...
Dumping String objects to closed archive heap region ...
Dumping objects to open archive heap region ...
Relocating SystemDictionary::_well_known_klasses[] ... 
Removing java_mirror ... done. 
mc  space:     13264 [  0.0% of total] out of     16384 bytes [ 81.0% used] at 0x0000000800000000
rw  space:  22853712 [ 21.5% of total] out of  22855680 bytes [100.0% used] at 0x0000000800004000
ro  space:  41573200 [ 39.1% of total] out of  41574400 bytes [100.0% used] at 0x00000008015d0000
md  space:      6160 [  0.0% of total] out of      8192 bytes [ 75.2% used] at 0x0000000803d76000
od  space:  36674096 [ 34.5% of total] out of  36675584 bytes [100.0% used] at 0x0000000803d78000
st0 space:    819200 [  0.8% of total] out of    819200 bytes [100.0% used] at 0x00000000ff400000
st1 space:   4194304 [  3.9% of total] out of   4194304 bytes [100.0% used] at 0x00000000ff500000
oa0 space:    176128 [  0.2% of total] out of    176128 bytes [100.0% used] at 0x00000000ff300000
total    : 106310064 [100.0% of total] out of 106319872 bytes [100.0% used]

Create OpenJ9 CDS archive in docker container:
==============================================
docker run -v /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples:/examples -p 8091:8080 -it - -rm -m 500m cds_demo_oj9:latest /bin/bash

/examples/tomcat_measure.sh 1 "-Xquickstart -Xmx64m -Xms64m -Xscmx128m -Xshareclasses:cacheDir=/tmp/tomcat_sa,name=tomcat,noaot,nojitdata,verbose -Xnoaot"

java -Xshareclasses:cacheDir=/tmp/tomcat_sa,name=tomcat,printStats

Current statistics for cache "tomcat": 

Cache created with:
	-Xnolinenumbers                      = false
	BCI Enabled                          = true
	Restrict Classpaths                  = false
	Feature                              = cr

Cache contains only classes with line numbers

base address                         = 0x00007FFFA4059000
end address                          = 0x00007FFFAC000000
allocation pointer                   = 0x00007FFFA5C1E7D8

cache size                           = 134217120
softmx bytes                         = 134217120
free bytes                           = 93735312
ROMClass bytes                       = 29120472
AOT bytes                            = 256
Reserved space for AOT bytes         = -1
Maximum space for AOT bytes          = -1
JIT data bytes                       = 0
Reserved space for JIT data bytes    = -1
Maximum space for JIT data bytes     = -1
Zip cache bytes                      = 0
Data bytes                           = 363936
Metadata bytes                       = 290200
Metadata % used                      = 0%
Class debug area size                = 10706944
Class debug area used bytes          = 5234970
Class debug area % used              = 48%

# ROMClasses                         = 11921
# AOT Methods                        = 0
# Classpaths                         = 5
# URLs                               = 0
# Tokens                             = 0
# Zip caches                         = 0
# Stale classes                      = 0
% Stale classes                      = 0%

Cache is 30% full

Create OpenJ9 CDS archive with AOT/JIT:
=======================================
JAVA_HOME=/share/software/Java/openJ9_jdk9-b181 CATALINA_HOME=/share/software/Java/apache-tomcat-9.0.2 /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples/tomcat_measure.sh 1 "-Xquickstart -Xmx64m -Xms64m -Xscmx128m -Xshareclasses:cacheDir=/tmp/tomcat,name=tomcat,verbose"

/share/software/Java/openJ9_jdk9-b181/bin/java -Xshareclasses:cacheDir=/tmp/tomcat,name=tomcat,printStats

Current statistics for cache "tomcat":

Cache created with:
        -Xnolinenumbers                      = false
        BCI Enabled                          = true
        Restrict Classpaths                  = false
        Feature                              = cr

Cache contains only classes with line numbers

base address                         = 0x00007FFFA4059000
end address                          = 0x00007FFFAC000000
allocation pointer                   = 0x00007FFFA5B11260

cache size                           = 134217120
softmx bytes                         = 134217120
free bytes                           = 80991164
ROMClass bytes                       = 28017248
AOT bytes                            = 13330160
Reserved space for AOT bytes         = -1
Maximum space for AOT bytes          = -1
JIT data bytes                       = 99072
Reserved space for JIT data bytes    = -1
Maximum space for JIT data bytes     = -1
Zip cache bytes                      = 0
Data bytes                           = 363936
Metadata bytes                       = 708596
Metadata % used                      = 1%
Class debug area size                = 10706944
Class debug area used bytes          = 5041880
Class debug area % used              = 47%

# ROMClasses                         = 11589
# AOT Methods                        = 6329
# Classpaths                         = 5
# URLs                               = 0
# Tokens                             = 0
# Zip caches                         = 0
# Stale classes                      = 0
% Stale classes                      = 0%

Cache is 39% full

Cache is accessible to current user = true


HotSpot Benchmarks (without G1)
==================

(1) docker run -v /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples:/examples -p 8091:8080 -i -x-rm -m 500m cds_demo_ojdk:latest /examples/tomcat_measure.sh 1 "-Xint -Xmx64m -Xms64m -Xshare:on -XX:+UseAppCDS -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/opt/tomcat_sa/tomcat_cl4cds.jsa"

(2) docker run -v /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples:/examples -p 8090:8080 -i -x-rm -m 500m cds_demo_ojdk:latest /examples/tomcat_measure.sh 1 "-Xint -Xmx64m -Xms64m -Xshare:on -XX:+UseAppCDS -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/opt/tomcat_sa/tomcat_cl4cds.jsa"

(3) docker run -v /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples:/examples -p 8080:8080 -i -x-rm -m 500m cds_demo_ojdk:latest /examples/tomcat_measure.sh 1 "-Xint -Xmx64m -Xms64m -Xshare:off -XX:+UseAppCDS -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/opt/tomcat_sa/tomcat_cl4cds.jsa"

CONTAINER           CPU %               MEM USAGE / LIMIT   MEM %               NET I/O             BLOCK I/O           PIDS
1c567fbd3e5f        2.23%               200.2MiB / 500MiB   40.03%              424kB / 6.54kB      45.1kB / 840kB      0      (3)
4dff19a42e28        6.19%               164.1MiB / 500MiB   32.81%              425kB / 6.43kB      86kB / 840kB        0      (2)
9bd6557f0d98        3.98%               164.9MiB / 500MiB   32.98%              425kB / 6.7kB       4.1kB / 836kB       0      (1)

CONTAINER           CPU %               MEM USAGE / LIMIT   MEM %               NET I/O             BLOCK I/O           PIDS
1c567fbd3e5f        5.26%               209.8MiB / 500MiB   41.95%              424kB / 6.54kB      45.1kB / 840kB      0
4dff19a42e28        2.98%               173.2MiB / 500MiB   34.63%              425kB / 6.43kB      86kB / 840kB        0
9bd6557f0d98        2.89%               173.9MiB / 500MiB   34.78%              425kB / 6.7kB       4.1kB / 836kB       0

docker run -v /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples:/examples -p 8080:8080 -i -x-rm -m 500m cds_demo_ojdk:latest /examples/tomcat_measure.sh 11 "-XX:TieredStopAtLevel=1 -XX:CICompilerCount=1 -Xmx64m -Xms64m -Xshare:on -XX:+UseAppCDS -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/opt/tomcat_sa/tomcat_cl4cds.jsa"

(15729+15051+15050+15373+15351+14951+14772+15372+14897+15234)/10
15178

docker run -v /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples:/examples -p 8080:8080 -i -x-rm -m 500m cds_demo_ojdk:latest /examples/tomcat_measure.sh 11 "-XX:TieredStopAtLevel=1 -XX:CICompilerCount=1 -Xmx64m -Xms64m -Xshare:off"

(15850+15522+15393+15529+15708+15844+15690+15570+15548+16217)/10
15687


HotSpot Benchmarks (with G1)
==================

(1) docker run -v /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples:/examples -p 8091:8080 -i --rm -m 500m cds_demo_ojdk:latest /examples/tomcat_measure.sh 1 "-Xint -Xmx64m -Xms64m -XX:+UseG1GC -Xshare:on -XX:+UseAppCDS -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/opt/tomcat_sa/tomcat_cl4cds.jsa"  (PID 22322)

(2) docker run -v /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples:/examples -p 8090:8080 -i --rm -m 500m cds_demo_ojdk:latest /examples/tomcat_measure.sh 1 "-Xint -Xmx64m -Xms64m -XX:+UseG1GC -Xshare:on -XX:+UseAppCDS -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/opt/tomcat_sa/tomcat_cl4cds.jsa"  (PID 22982)

(3) docker run -v /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples:/examples -p 8080:8080 -i --rm -m 500m cds_demo_ojdk:latest /examples/tomcat_measure.sh 1 "-Xint -Xmx64m -Xms64m -XX:+UseG1GC -Xshare:off -XX:+UseAppCDS -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/opt/tomcat_sa/tomcat_cl4cds.jsa" (PID 23693)

CONTAINER           CPU %               MEM USAGE / LIMIT   MEM %               NET I/O             BLOCK I/O           PIDS
77d960c7a8b4        1.47%               164.3MiB / 500MiB   32.85%              423kB / 6.11kB      0B / 836kB          0

CONTAINER           CPU %               MEM USAGE / LIMIT   MEM %               NET I/O             BLOCK I/O           PIDS
5e35f512b41c        3.23%               217.5MiB / 500MiB   43.51%              424kB / 6.33kB      0B / 836kB          0  (3)
b88085462057        3.74%               172.3MiB / 500MiB   34.46%              424kB / 6.22kB      0B / 836kB          0  (2)
77d960c7a8b4        3.54%               174.6MiB / 500MiB   34.92%              424kB / 6.11kB      0B / 836kB          0  (1)

22322:   /opt/jdk/bin/java -Djava.util.logging.config.file=/opt/apache-tomcat-9.0.2/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djdk.tls.ephemeralDHKeySize=2048 -Djava.protocol.handler.pkgs=org.apache.catalina.webresources -Djava.security.egd=file:/dev/./urandom -Xint -Xmx64m -Xms64m -XX:+UseG1GC -Xshare:on -XX:+UseAppCDS -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/opt/tomcat_sa/tomcat_cl4cds.jsa -Dignore.endorsed.dirs= -classpath /opt/apache-tomcat-9.0.2/bi
         Address Perm    Size    Rss    Pss Shared_Clean Shared_Dirty Private_Clean Private_Dirty Referenced Mapping
        00400000 r-xp       4      4      1            4            0             0             0          4 /opt/jdk/bin/java
        00601000 r--p       4      4      4            0            0             0             4          4 /opt/jdk/bin/java
        00602000 rw-p       4      4      4            0            0             0             4          4 /opt/jdk/bin/java
        00603000 rw-p     132     60     60            0            0             0            60         60 [heap]
        fc000000 rw-p   52224  52224  52224            0            0             0         52224      52224 
        ff300000 rw-p     172    172    160           24            0             0           148        172 /opt/tomcat_sa/tomcat_cl4cds.jsa
        ff32b000 rw-p     852      0      0            0            0             0             0          0 
        ff400000 rw-p     408    408    204          408            0             0             0        408 /opt/tomcat_sa/tomcat_cl4cds.jsa
        ff466000 rw-p     616      0      0            0            0             0             0          0 
        ff500000 rw-p    3072   3072   1536         3072            0             0             0       3072 /opt/tomcat_sa/tomcat_cl4cds.jsa
        ff800000 rw-p    8192   8192   8192            0            0             0          8192       8192 
       800000000 rwxp      16     16     16            0            0             0            16         16 /opt/tomcat_sa/tomcat_cl4cds.jsa
       800004000 rw-p   22340  22340  21518         1644            0             0         20696      22224 /opt/tomcat_sa/tomcat_cl4cds.jsa
       8015d5000 r--p   39320  39320  19660        39320            0             0             0      39320 /opt/tomcat_sa/tomcat_cl4cds.jsa
       803c3b000 rw-p       8      8      8            0            0             0             8          8 /opt/tomcat_sa/tomcat_cl4cds.jsa
       803c3d000 r--p   35840  35840  17920        35840            0             0             0      35840 /opt/tomcat_sa/tomcat_cl4cds.jsa
       840000000 rw-p    3328   3204   3204            0            0             0          3204       3200 
       840340000 ---p 1045248      0      0            0            0             0             0          0 

After killing 22982 and 23693:

22322:   /opt/jdk/bin/java -Djava.util.logging.config.file=/opt/apache-tomcat-9.0.2/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djdk.tls.ephemeralDHKeySize=2048 -Djava.protocol.handler.pkgs=org.apache.catalina.webresources -Djava.security.egd=file:/dev/./urandom -Xint -Xmx64m -Xms64m -XX:+UseG1GC -Xshare:on -XX:+UseAppCDS -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/opt/tomcat_sa/tomcat_cl4cds.jsa -Dignore.endorsed.dirs= -classpath /opt/apache-tomcat-9.0.2/bi
         Address Perm    Size    Rss    Pss Shared_Clean Shared_Dirty Private_Clean Private_Dirty Referenced Mapping
        00400000 r-xp       4      4      4            0            0             4             0          4 /opt/jdk/bin/java
        00601000 r--p       4      4      4            0            0             0             4          4 /opt/jdk/bin/java
        00602000 rw-p       4      4      4            0            0             0             4          4 /opt/jdk/bin/java
        00603000 rw-p     132     60     60            0            0             0            60         60 [heap]
        fc000000 rw-p   52224  52224  52224            0            0             0         52224      52220 
        ff300000 rw-p     172    172    172            0            0            24           148        172 /opt/tomcat_sa/tomcat_cl4cds.jsa
        ff32b000 rw-p     852      0      0            0            0             0             0          0 
        ff400000 rw-p     408    408    408            0            0           408             0        408 /opt/tomcat_sa/tomcat_cl4cds.jsa
        ff466000 rw-p     616      0      0            0            0             0             0          0 
        ff500000 rw-p    3072   3072   3072            0            0          3072             0       3072 /opt/tomcat_sa/tomcat_cl4cds.jsa
        ff800000 rw-p    8192   8192   8192            0            0             0          8192       8192 
       800000000 rwxp      16     16     16            0            0             0            16         16 /opt/tomcat_sa/tomcat_cl4cds.jsa
       800004000 rw-p   22340  22340  22340            0            0          1644         20696      22248 /opt/tomcat_sa/tomcat_cl4cds.jsa
       8015d5000 r--p   39320  39320  39320            0            0         39320             0      39320 /opt/tomcat_sa/tomcat_cl4cds.jsa
       803c3b000 rw-p       8      8      8            0            0             0             8          8 /opt/tomcat_sa/tomcat_cl4cds.jsa
       803c3d000 r--p   35840  35840  35840            0            0         35840             0      35840 /opt/tomcat_sa/tomcat_cl4cds.jsa
       840000000 rw-p    3328   3204   3204            0            0             0          3204       3188 
       840340000 ---p 1045248      0      0            0            0             0             0          0 

(1) docker run -v /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples:/examples -p 8091:8080 -i --rm -m 500m cds_demo_ojdk:latest /examples/tomcat_measure.sh 1 "-Xint -Xmx64m -Xms64m -XX:+UseG1GC -Xshare:on -XX:+UseAppCDS -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/opt/tomcat_sa/tomcat_cl4cds.jsa"  (PID 1508)

(2) docker run -v /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples:/examples -p 8090:8080 -i --rm -m 500m cds_demo_ojdk:latest /examples/tomcat_measure.sh 1 "-Xint -Xmx64m -Xms64m -XX:+UseG1GC -Xshare:on -XX:+UseAppCDS -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/opt/tomcat_sa/tomcat_cl4cds.jsa"  (PID 1750)

(3) docker run -v /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples:/examples -p 8080:8080 -i --rm -m 500m cds_demo_ojdk:latest /examples/tomcat_measure.sh 1 "-Xint -Xmx64m -Xms64m -XX:+UseG1GC -Xshare:off -XX:+UseAppCDS -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/opt/tomcat_sa/tomcat_cl4cds.jsa" (PID 1993)


CONTAINER           CPU %               MEM USAGE / LIMIT   MEM %               NET I/O             BLOCK I/O           PIDS
fd41c34a085e        2.97%               207.7MiB / 500MiB   41.54%              423kB / 5.89kB      0B / 836kB          0
4e205647ee0f        3.25%               163MiB / 500MiB     32.59%              424kB / 6.49kB      0B / 836kB          0
e007e650adb9        3.35%               163.4MiB / 500MiB   32.67%              425kB / 6.65kB      32.8kB / 840kB      0

CONTAINER           CPU %               MEM USAGE / LIMIT   MEM %               NET I/O             BLOCK I/O           PIDS
fd41c34a085e        5.28%               221.2MiB / 500MiB   44.24%              425kB / 5.89kB      0B / 836kB          0
4e205647ee0f        3.73%               176MiB / 500MiB     35.21%              426kB / 6.49kB      0B / 836kB          0
e007e650adb9        4.59%               176.5MiB / 500MiB   35.30%              426kB / 6.65kB      32.8kB / 840kB      0

1508:   /opt/jdk/bin/java -Djava.util.logging.config.file=/opt/apache-tomcat-9.0.2/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djdk.tls.ephemeralDHKeySize=2048 -Djava.protocol.handler.pkgs=org.apache.catalina.webresources -Djava.security.egd=file:/dev/./urandom -Xint -Xmx64m -Xms64m -XX:+UseG1GC -Xshare:on -XX:+UseAppCDS -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/opt/tomcat_sa/tomcat_cl4cds.jsa -Dignore.endorsed.dirs= -classpath /opt/apache-tomcat-9.0.2/bi
         Address Perm    Size    Rss    Pss Shared_Clean Shared_Dirty Private_Clean Private_Dirty Referenced Mapping
        00400000 r-xp       4      4      1            4            0             0             0          4 /opt/jdk/bin/java
        00601000 r--p       4      4      4            0            0             0             4          4 /opt/jdk/bin/java
        00602000 rw-p       4      4      4            0            0             0             4          0 /opt/jdk/bin/java
        00603000 rw-p     132     88     88            0            0             0            88         84 [heap]
        fc000000 rw-p   52224  52224  52224            0            0             0         52224      52224 
        ff300000 rw-p     172    172    160           24            0             0           148        172 /opt/tomcat_sa/tomcat_cl4cds.jsa
        ff32b000 rw-p     852      0      0            0            0             0             0          0 
        ff400000 rw-p     408    408    204          408            0             0             0        408 /opt/tomcat_sa/tomcat_cl4cds.jsa
        ff466000 rw-p     616      0      0            0            0             0             0          0 
        ff500000 rw-p    3072   3072   1536         3072            0             0             0       3072 /opt/tomcat_sa/tomcat_cl4cds.jsa
        ff800000 rw-p    8192   8192   8192            0            0             0          8192       8192 
       800000000 rwxp      16     16     16            0            0             0            16         16 /opt/tomcat_sa/tomcat_cl4cds.jsa
       800004000 rw-p   22340  22340  21520         1640            0             0         20700      22016 /opt/tomcat_sa/tomcat_cl4cds.jsa
       8015d5000 r--p   39320  39320  19660        39320            0             0             0      39320 /opt/tomcat_sa/tomcat_cl4cds.jsa
       803c3b000 rw-p       8      8      8            0            0             0             8          8 /opt/tomcat_sa/tomcat_cl4cds.jsa
       803c3d000 r--p   35840  35840  17920        35840            0             0             0      35840 /opt/tomcat_sa/tomcat_cl4cds.jsa
       840000000 rw-p    3328   3204   3204            0            0             0          3204       3204 
       840340000 ---p 1045248      0      0            0            0             0             0          0 
                      ======= ====== ====== ============ ============ ============= ============= ========== 
                      3941460 280800 221471       108632            0           112        172056     273492 KB 

1508:   /opt/jdk/bin/java -Djava.util.logging.config.file=/opt/apache-tomcat-9.0.2/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djdk.tls.ephemeralDHKeySize=2048 -Djava.protocol.handler.pkgs=org.apache.catalina.webresources -Djava.security.egd=file:/dev/./urandom -Xint -Xmx64m -Xms64m -XX:+UseG1GC -Xshare:on -XX:+UseAppCDS -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/opt/tomcat_sa/tomcat_cl4cds.jsa -Dignore.endorsed.dirs= -classpath /opt/apache-tomcat-9.0.2/bi
         Address Perm    Size    Rss    Pss Shared_Clean Shared_Dirty Private_Clean Private_Dirty Referenced Mapping
        00400000 r-xp       4      4      4            0            0             4             0          4 /opt/jdk/bin/java
        00601000 r--p       4      4      4            0            0             0             4          4 /opt/jdk/bin/java
        00602000 rw-p       4      4      4            0            0             0             4          0 /opt/jdk/bin/java
        00603000 rw-p     132     88     88            0            0             0            88         84 [heap]
        fc000000 rw-p   52224  52224  52224            0            0             0         52224      52224 
        ff300000 rw-p     172    172    172            0            0            24           148        172 /opt/tomcat_sa/tomcat_cl4cds.jsa
        ff32b000 rw-p     852      0      0            0            0             0             0          0 
        ff400000 rw-p     408    408    408            0            0           408             0        408 /opt/tomcat_sa/tomcat_cl4cds.jsa
        ff466000 rw-p     616      0      0            0            0             0             0          0 
        ff500000 rw-p    3072   3072   3072            0            0          3072             0       3072 /opt/tomcat_sa/tomcat_cl4cds.jsa
        ff800000 rw-p    8192   8192   8192            0            0             0          8192       8192 
       800000000 rwxp      16     16     16            0            0             0            16         16 /opt/tomcat_sa/tomcat_cl4cds.jsa
       800004000 rw-p   22340  22340  22340            0            0          1640         20700      22016 /opt/tomcat_sa/tomcat_cl4cds.jsa
       8015d5000 r--p   39320  39320  39320            0            0         39320             0      39320 /opt/tomcat_sa/tomcat_cl4cds.jsa
       803c3b000 rw-p       8      8      8            0            0             0             8          8 /opt/tomcat_sa/tomcat_cl4cds.jsa
       803c3d000 r--p   35840  35840  35840            0            0         35840             0      35840 /opt/tomcat_sa/tomcat_cl4cds.jsa
       840000000 rw-p    3328   3204   3204            0            0             0          3204       3204 
       840340000 ---p 1045248      0      0            0            0             0             0          0 
                      ======= ====== ====== ============ ============ ============= ============= ========== 
                      3941460 280804 279958         1688            0        107056        172060     273556 KB 

1993:   /opt/jdk/bin/java -Djava.util.logging.config.file=/opt/apache-tomcat-9.0.2/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djdk.tls.ephemeralDHKeySize=2048 -Djava.protocol.han
dler.pkgs=org.apache.catalina.webresources -Djava.security.egd=file:/dev/./urandom -Xint -Xmx64m -Xms64m -XX:+UseG1GC -Xshare:off -XX:+UseAppCDS -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/opt/tomcat_sa/tomcat_cl4cds
.jsa -Dignore.endorsed.dirs= -classpath /opt/apache-tomcat-9.0.2/b
         Address Perm    Size    Rss    Pss Shared_Clean Shared_Dirty Private_Clean Private_Dirty Referenced Mapping
        00400000 r-xp       4      4      1            4            0             0             0          4 /opt/jdk/bin/java
        00601000 r--p       4      4      4            0            0             0             4          4 /opt/jdk/bin/java
        00602000 rw-p       4      4      4            0            0             0             4          4 /opt/jdk/bin/java
        00603000 rw-p     132    104    104            0            0             0           104         56 [heap]
        fc000000 rw-p   74288  74228  74228            0            0             0         74228      74228 
       10088c000 ---p 1039824      0      0            0            0             0             0          0 
                      ======= ====== ====== ============ ============ ============= ============= ========== 
                      3880800 249176 230013        28300            0          3056        217820     237724 KB 

5783:   /opt/jdk/bin/java -Djava.util.logging.config.file=/opt/apache-tomcat-9.0.2/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djdk.tls.ephemeralDHKeySize=2048 -Djava.protocol.handler.pkgs=org.apache.catalina.webresources -Djava.security.egd=file:/dev/./urandom -Xint -Xmx64m -Xms64m -XX:+UseG1GC -Xshare:off -XX:+UseAppCDS -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/opt/tomcat_sa/tomcat_cl4cds.jsa -Dignore.endorsed.dirs= -classpath /opt/apache-tomcat-9.0.2/b
         Address Perm    Size    Rss    Pss Shared_Clean Shared_Dirty Private_Clean Private_Dirty Referenced Mapping
        00400000 r-xp       4      4      2            4            0             0             0          4 /opt/jdk/bin/java
        00601000 r--p       4      4      4            0            0             0             4          4 /opt/jdk/bin/java
        00602000 rw-p       4      4      4            0            0             0             4          0 /opt/jdk/bin/java
        00603000 rw-p     132     56     56            0            0             0            56         56 [heap]
        fc000000 rw-p   74288  74220  74220            0            0             0         74220      74220 
       10088c000 ---p 1039824      0      0            0            0             0             0          0 
                      ======= ====== ====== ============ ============ ============= ============= ========== 
                      3880800 248004 233431        28300            0          3056        216648     243800 KB 

5783:   /opt/jdk/bin/java -Djava.util.logging.config.file=/opt/apache-tomcat-9.0.2/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djdk.tls.ephemeralDHKeySize=2048 -Djava.protocol.handler.pkgs=org.apache.catalina.webresources -Djava.security.egd=file:/dev/./urandom -Xint -Xmx64m -Xms64m -XX:+UseG1GC -Xshare:off -XX:+UseAppCDS -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/opt/tomcat_sa/tomcat_cl4cds.jsa -Dignore.endorsed.dirs= -classpath /opt/apache-tomcat-9.0.2/b
         Address Perm    Size    Rss    Pss Shared_Clean Shared_Dirty Private_Clean Private_Dirty Referenced Mapping
        00400000 r-xp       4      4      4            0            0             4             0          4 /opt/jdk/bin/java
        00601000 r--p       4      4      4            0            0             0             4          4 /opt/jdk/bin/java
        00602000 rw-p       4      4      4            0            0             0             4          0 /opt/jdk/bin/java
        00603000 rw-p     132     56     56            0            0             0            56         56 [heap]
        fc000000 rw-p   74288  74220  74220            0            0             0         74220      74220 
       10088c000 ---p 1039824      0      0            0            0             0             0          0 
                      ======= ====== ====== ============ ============ ============= ============= ========== 
                      3880800 248004 247158         1688            0         29668        216648     243800 KB 


docker run -v /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples:/examples -p 8090:8080 -i --rm -m 500m cds_demo_ojdk:latest /examples/tomcat_measure.sh 11 "-XX:TieredStopAtLevel=1 -XX:CICompilerCount=1 -Xmx64m -Xms64m -XX:+UseG1GC -Xshare:on -XX:+UseAppCDS -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/opt/tomcat_sa/tomcat_cl4cds.jsa"

(17437+17334+17159+17232+17089+17245+17150+17072+17212+17396)/10
17232

docker run -v /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples:/examples -p 8080:8080 -i --rm -m 500m cds_demo_ojdk:latest /examples/tomcat_measure.sh 11 "-XX:TieredStopAtLevel=1 -XX:CICompilerCount=1 -Xmx64m -Xms64m -XX:+UseG1GC -Xshare:off -XX:+UseAppCDS -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/opt/tomcat_sa/tomcat_cl4cds.jsa"

(17577+19170+17816+17092+17901+17687+17351+17486+17768+17883)/10
17773

With Symbol and String sharing
------------------------------

CONTAINER           CPU %               MEM USAGE / LIMIT   MEM %               NET I/O             BLOCK I/O           PIDS
7b1e0fc0ec28        2.10%               156.3MiB / 500MiB   31.25%              7.13kB / 2.21kB     32.8kB / 840kB      0

22102:   /opt/jdk/bin/java -Djava.util.logging.config.file=/opt/apache-tomcat-9.0.2/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djdk.tls.ephemeralDHKeySize=2048 -Djava.protocol.handler.pkgs=org.apache.catalina.webresources -Djava.security.egd=file:/dev/./urandom -Xint -Xmx64m -Xms64m -XX:+UseG1GC -Xshare:on -XX:+UseAppCDS -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/opt/tomcat_sa/tomcat_cl4cds.jsa -Dignore.endorsed.dirs= -classpath /opt/apache-tomcat-9.0.2/bi
         Address Perm    Size    Rss    Pss Shared_Clean Shared_Dirty Private_Clean Private_Dirty Referenced Mapping
        00400000 r-xp       4      4      4            0            0             4             0          4 /opt/jdk/bin/java
        00601000 r--p       4      4      4            0            0             0             4          4 /opt/jdk/bin/java
        00602000 rw-p       4      4      4            0            0             0             4          4 /opt/jdk/bin/java
        00603000 rw-p     132     44     44            0            0             0            44         44 [heap]
        fc000000 rw-p   52224  52224  52224            0            0             0         52224      52224 
        ff300000 rw-p     172    172    172            0            0            24           148        172 /opt/tomcat_sa/tomcat_cl4cds.jsa
        ff32b000 rw-p     852      0      0            0            0             0             0          0 
        ff400000 rw-p     800    800    800            0            0           800             0        800 /opt/tomcat_sa/tomcat_cl4cds.jsa
        ff4c8000 rw-p     224      0      0            0            0             0             0          0 
        ff500000 rw-p    4096   4096   4096            0            0          4096             0       4096 /opt/tomcat_sa/tomcat_cl4cds.jsa
        ff900000 rw-p    7168   7168   7168            0            0             0          7168       7168 
       800000000 rwxp      16     16     16            0            0             0            16         16 /opt/tomcat_sa/tomcat_cl4cds.jsa
       800004000 rw-p   22320  22320  22320            0            0          2052         20268      22320 /opt/tomcat_sa/tomcat_cl4cds.jsa
       8015d0000 r--p   40600  40600  40600            0            0         40600             0      40600 /opt/tomcat_sa/tomcat_cl4cds.jsa
       803d76000 rw-p       8      8      8            0            0             0             8          8 /opt/tomcat_sa/tomcat_cl4cds.jsa
       803d78000 r--p   35816  35816  35816            0            0         35816             0      35816 /opt/tomcat_sa/tomcat_cl4cds.jsa
       840000000 rw-p    3200   2888   2888            0            0             0          2888       2888 
       840320000 ---p 1045376      0      0            0            0             0             0          0 


OpenJ9 Benchmarks
=================

(1) docker run -v /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples:/examples -p 8091:8080 -i -x-rm -m 500m cds_demo_oj9:latest /examples/tomcat_measure.sh 1 "-Xmx64m -Xms64m -Xscmx128m -Xshareclasses:cacheDir=/opt/tomcat_sa,name=tomcat,noaot,nojitdata,verbose -Xint -Xnoaot -Xnojit"  (PID 3768)

(2) docker run -v /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples:/examples -p 8090:8080 -i -x-rm -m 500m cds_demo_oj9:latest /examples/tomcat_measure.sh 1 "-Xmx64m -Xms64m -Xscmx128m -Xshareclasses:cacheDir=/opt/tomcat_sa,name=tomcat,noaot,nojitdata,verbose -Xint -Xnoaot -Xnojit"  (PID 5003)

(3) docker run -v /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples:/examples -p 8080:8080 -i -x-rm -m 500m cds_demo_oj9:latest /examples/tomcat_measure.sh 1 "-Xmx64m -Xms64m -Xscmx128m -Xshareclasses:none -Xint -Xnoaot -Xnojit"                                                         (PID 5386)

CONTAINER           CPU %               MEM USAGE / LIMIT   MEM %               NET I/O             BLOCK I/O           PIDS
6d2e95e90154        1.53%               150.9MiB / 500MiB   30.18%              425kB / 6.77kB      28.7kB / 840kB      0     (3)
1e595c6d8bb4        2.13%               124.5MiB / 500MiB   24.89%              423kB / 6.07kB      53.2kB / 840kB      0     (2)
7d01485605be        2.17%               124.6MiB / 500MiB   24.93%              424kB / 6.4kB       0B / 840kB          0     (1)

CONTAINER           CPU %               MEM USAGE / LIMIT   MEM %               NET I/O             BLOCK I/O           PIDS
6d2e95e90154        3.69%               155.6MiB / 500MiB   31.12%              425kB / 6.77kB      28.7kB / 840kB      0
1e595c6d8bb4        5.25%               129.3MiB / 500MiB   25.86%              424kB / 6.07kB      53.2kB / 840kB      0
7d01485605be        2.89%               129.2MiB / 500MiB   25.83%              424kB / 6.4kB       0B / 840kB          0



3768:   /opt/jdk-9+181/bin/java -Djava.util.logging.config.file=/opt/apache-tomcat-9.0.2/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djdk.tls.ephemeralDHKeySize=2048 -Djava.protoc
ol.handler.pkgs=org.apache.catalina.webresources -Djava.security.egd=file:/dev/./urandom -Xmx64m -Xms64m -Xscmx128m -Xshareclasses:cacheDir=/opt/tomcat_sa,name=tomcat,noaot,nojitdata,verbose -Xint -Xnoaot -Xnojit -Dignore.endo
rsed.dirs= -classpath /opt/apache-tomcat-9.0.2/bin/bootstrap.jar:/
         Address Perm    Size    Rss    Pss Shared_Clean Shared_Dirty Private_Clean Private_Dirty Referenced Mapping
        00400000 r-xp       4      4      1            4            0             0             0          4 /opt/jdk-9+181/bin/java
        00601000 r--p       4      4      4            0            0             0             4          0 /opt/jdk-9+181/bin/java
        00602000 rw-p       4      4      4            0            0             0             4          4 /opt/jdk-9+181/bin/java
        00603000 rw-p     132    116    116            0            0             0           116        116 [heap]
        00624000 rw-p   51200  24376  24376            0            0             0         24376      24256 [heap]
        03824000 ---p  153600      0      0            0            0             0             0          0 
        fbff1000 ---p      60      0      0            0            0             0             0          0 
        fc000000 rw-p   65536  63488  63488            0            0             0         63488      63488 
    7fffde614000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffde615000 r--s   29332  29332  29332            0            0         29332             0      29236 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe02ba000 rw-s   90992      0      0            0            0             0             0          0 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5b96000 r--s      28     28     28            0            0            28             0         28 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5b9d000 rw-s       8      8      8            0            0             8             0          8 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5b9f000 r--s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5ba0000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5ba1000 r--s      16     16     16            0            0            16             0         16 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5ba5000 rw-s      12     12     12            0            0            12             0         12 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5ba8000 r--s       8      8      8            0            0             8             0          8 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5baa000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bab000 r--s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bac000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bad000 r--s      24     24     24            0            0            24             0         24 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bb3000 rw-s       8      8      8            0            0             8             0          8 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bb5000 r--s      12     12     12            0            0            12             0         12 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bb8000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bb9000 r--s      12     12     12            0            0            12             0         12 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bbc000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bbd000 r--s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bbe000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bbf000 r--s      44     44     44            0            0            44             0         44 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bca000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bcb000 r--s      20     20     20            0            0            20             0         20 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bd0000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bd1000 r--s      36     36     36            0            0            36             0         36 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bda000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bdb000 r--s    2132   2132   2132            0            0          2132             0       2132 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5df0000 rw-s    5340      0      0            0            0             0             0          0 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe6327000 r--s    2996   2560   2560            0            0          2560             0       2560 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe6614000 r--s  138388  16304   5857        16304            0             0             0      16096 /opt/jdk-9+181/lib/modules
    7fffeed39000 r-xp     100     64     21           64            0             0             0         64 /opt/jdk-9+181/lib/libjimage.so
    7fffeed52000 ---p    2048      0      0            0            0             0             0          0 /opt/jdk-9+181/lib/libjimage.so
    7fffeef52000 r--p       8      8      8            0            0             0             8          8 /opt/jdk-9+181/lib/libjimage.so
    7fffeef54000 rw-p       4      4      4            0            0             0             4          4 /opt/jdk-9+181/lib/libjimage.so
    7ffff77f5000 r-xp    1792   1696    343         1696            0             0             0       1696 /lib/x86_64-linux-gnu/libc-2.23.so
    7ffff79b5000 ---p    2048      0      0            0            0             0             0          0 /lib/x86_64-linux-gnu/libc-2.23.so
    7ffff7bb5000 r--p      16     16     16            0            0             0            16         16 /lib/x86_64-linux-gnu/libc-2.23.so
    7ffff7bb9000 rw-p       8      8      8            0            0             0             8          8 /lib/x86_64-linux-gnu/libc-2.23.so
    7ffff7bbb000 rw-p      16     16     16            0            0             0            16         16 
    7ffff7bbf000 r-xp      92     92     30           92            0             0             0         92 /opt/jdk-9+181/lib/jli/libjli.so
    7ffff7bd6000 ---p    2044      0      0            0            0             0             0          0 /opt/jdk-9+181/lib/jli/libjli.so
    7ffff7dd5000 r--p       4      4      4            0            0             0             4          4 /opt/jdk-9+181/lib/jli/libjli.so
    7ffff7dd6000 rw-p       4      4      4            0            0             0             4          4 /opt/jdk-9+181/lib/jli/libjli.so
                      ======= ====== ====== ============ ============ ============= ============= ========== 
                      2722488 184164 167064        25956            0         34388        123820     181776 KB 

5003:   /opt/jdk-9+181/bin/java -Djava.util.logging.config.file=/opt/apache-tomcat-9.0.2/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djdk.tls.ephemeralDHKeySize=2048 -Djava.protocol.handler.pkgs=org.apache.catalina.webresources -Djava.security.egd=file:/dev/./urandom -Xmx64m -Xms64m -Xscmx128m -Xshareclasses:cacheDir=/opt/tomcat_sa,name=tomcat,noaot,nojitdata,verbose -Xint -Xnoaot -Xnojit -Dignore.endorsed.dirs= -classpath /opt/apache-tomcat-9.0.2/bin/bootstrap.jar:/
         Address Perm    Size    Rss    Pss Shared_Clean Shared_Dirty Private_Clean Private_Dirty Referenced Mapping
        00400000 r-xp       4      4      1            4            0             0             0          4 /opt/jdk-9+181/bin/java
        00601000 r--p       4      4      4            0            0             0             4          4 /opt/jdk-9+181/bin/java
        00602000 rw-p       4      4      4            0            0             0             4          0 /opt/jdk-9+181/bin/java
        00603000 rw-p     132     28     28            0            0             0            28         28 [heap]
        00624000 rw-p   51200  24376  24376            0            0             0         24376      24320 [heap]
        03824000 ---p  153600      0      0            0            0             0             0          0 
        fbff1000 ---p      60      0      0            0            0             0             0          0 
        fc000000 rw-p   65536  63488  63488            0            0             0         63488      63488 
    7fffde614000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffde615000 r--s   29332  29332  29332            0            0         29332             0      29236 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe02ba000 rw-s   90992      0      0            0            0             0             0          0 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5b96000 r--s      28     28     28            0            0            28             0         28 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5b9d000 rw-s       8      8      8            0            0             8             0          8 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5b9f000 r--s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5ba0000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5ba1000 r--s      16     16     16            0            0            16             0         16 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5ba5000 rw-s      12     12     12            0            0            12             0         12 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5ba8000 r--s       8      8      8            0            0             8             0          8 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5baa000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bab000 r--s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bac000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bad000 r--s      24     24     24            0            0            24             0         24 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bb3000 rw-s       8      8      8            0            0             8             0          8 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bb5000 r--s      12     12     12            0            0            12             0         12 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bb8000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bb9000 r--s      12     12     12            0            0            12             0         12 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bbc000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bbd000 r--s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bbe000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bbf000 r--s      44     44     44            0            0            44             0         44 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bca000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bcb000 r--s      20     20     20            0            0            20             0         20 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bd0000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bd1000 r--s      36     36     36            0            0            36             0         36 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bda000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bdb000 r--s    2132   2132   2132            0            0          2132             0       2132 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5df0000 rw-s    5340      0      0            0            0             0             0          0 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe6614000 r--s  138388  16304   5857        16304            0             0             0      16060 /opt/jdk-9+181/lib/modules
    7fffeed39000 r-xp     100     64     21           64            0             0             0         64 /opt/jdk-9+181/lib/libjimage.so
    7fffeed52000 ---p    2048      0      0            0            0             0             0          0 /opt/jdk-9+181/lib/libjimage.so
    7fffeef52000 r--p       8      8      8            0            0             0             8          8 /opt/jdk-9+181/lib/libjimage.so
    7fffeef54000 rw-p       4      4      4            0            0             0             4          4 /opt/jdk-9+181/lib/libjimage.so
    7ffff77f5000 r-xp    1792   1696    343         1696            0             0             0       1696 /lib/x86_64-linux-gnu/libc-2.23.so
    7ffff79b5000 ---p    2048      0      0            0            0             0             0          0 /lib/x86_64-linux-gnu/libc-2.23.so
    7ffff7bb5000 r--p      16     16     16            0            0             0            16         12 /lib/x86_64-linux-gnu/libc-2.23.so
    7ffff7bb9000 rw-p       8      8      8            0            0             0             8          8 /lib/x86_64-linux-gnu/libc-2.23.so
    7ffff7bbb000 rw-p      16     16     16            0            0             0            16         16 
    7ffff7bbf000 r-xp      92     92     30           92            0             0             0         92 /opt/jdk-9+181/lib/jli/libjli.so
    7ffff7bd6000 ---p    2044      0      0            0            0             0             0          0 /opt/jdk-9+181/lib/jli/libjli.so
    7ffff7dd5000 r--p       4      4      4            0            0             0             4          4 /opt/jdk-9+181/lib/jli/libjli.so
    7ffff7dd6000 rw-p       4      4      4            0            0             0             4          4 /opt/jdk-9+181/lib/jli/libjli.so
                      ======= ====== ====== ============ ============ ============= ============= ========== 
                      2722488 184296 167196        25956            0         34388        123952     181460 KB 

5386:   /opt/jdk-9+181/bin/java -Djava.util.logging.config.file=/opt/apache-tomcat-9.0.2/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djdk.tls.ephemeralDHKeySize=2048 -Djava.protocol.handler.pkgs=org.apache.catalina.webresources -Djava.security.egd=file:/dev/./urandom -Xmx64m -Xms64m -Xscmx128m -Xshareclasses:none -Xint -Xnoaot -Xnojit -Dignore.endorsed.dirs= -classpath /opt/apache-tomcat-9.0.2/bin/boot
strap.jar:/opt/apache-tomcat-9.0.2/bin/tomcat-juli.jar -Dcatalina.
         Address Perm    Size    Rss    Pss Shared_Clean Shared_Dirty Private_Clean Private_Dirty Referenced Mapping
        00400000 r-xp       4      4      1            4            0             0             0          4 /opt/jdk-9+181/bin/java
        00601000 r--p       4      4      4            0            0             0             4          4 /opt/jdk-9+181/bin/java
        00602000 rw-p       4      4      4            0            0             0             4          4 /opt/jdk-9+181/bin/java
        00603000 rw-p     132     80     80            0            0             0            80         60 [heap]
        00624000 rw-p   51200  24368  24368            0            0             0         24368      24280 [heap]
        03824000 ---p  153600      0      0            0            0             0             0          0 
        fbff1000 ---p      60      0      0            0            0             0             0          0 
        fc000000 rw-p   65536  63488  63488            0            0             0         63488      63488 
                      ======= ====== ====== ============ ============ ============= ============= ========== 
                      2587408 177772 162206        22888            0          3100        151784     173512 KB 

After killing 5003 and 5386:

3768:   /opt/jdk-9+181/bin/java -Djava.util.logging.config.file=/opt/apache-tomcat-9.0.2/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djdk.tls.ephemeralDHKeySize=2048 -Djava.protocol.handler.pkgs=org.apache.catalina.webresources -Djava.security.egd=file:/dev/./urandom -Xmx64m -Xms64m -Xscmx128m -Xshareclasses:cacheDir=/opt/tomcat_sa,name=tomcat,noaot,nojitdata,verbose -Xint -Xnoaot -Xnojit -Dignore.endorsed.dirs= -classpath /opt/apache-tomcat-9.0.2/bin/bootstrap.jar:/
         Address Perm    Size    Rss    Pss Shared_Clean Shared_Dirty Private_Clean Private_Dirty Referenced Mapping
        00400000 r-xp       4      4      4            0            0             4             0          4 /opt/jdk-9+181/bin/java
        00601000 r--p       4      4      4            0            0             0             4          0 /opt/jdk-9+181/bin/java
        00602000 rw-p       4      4      4            0            0             0             4          4 /opt/jdk-9+181/bin/java
        00603000 rw-p     132    116    116            0            0             0           116        116 [heap]
        00624000 rw-p   51200  24376  24376            0            0             0         24376      24236 [heap]
        03824000 ---p  153600      0      0            0            0             0             0          0 
        fbff1000 ---p      60      0      0            0            0             0             0          0 
        fc000000 rw-p   65536  63488  63488            0            0             0         63488      63488 
    7fffde614000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffde615000 r--s   29332  29332  29332            0            0         29332             0      29224 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe02ba000 rw-s   90992      0      0            0            0             0             0          0 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5b96000 r--s      28     28     28            0            0            28             0         28 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5b9d000 rw-s       8      8      8            0            0             8             0          8 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5b9f000 r--s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5ba0000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5ba1000 r--s      16     16     16            0            0            16             0         16 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5ba5000 rw-s      12     12     12            0            0            12             0         12 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5ba8000 r--s       8      8      8            0            0             8             0          8 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5baa000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bab000 r--s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bac000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bad000 r--s      24     24     24            0            0            24             0         24 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bb3000 rw-s       8      8      8            0            0             8             0          8 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bb5000 r--s      12     12     12            0            0            12             0         12 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bb8000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bb9000 r--s      12     12     12            0            0            12             0         12 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bbc000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bbd000 r--s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bbe000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bbf000 r--s      44     44     44            0            0            44             0         44 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bca000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bcb000 r--s      20     20     20            0            0            20             0         20 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bd0000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bd1000 r--s      36     36     36            0            0            36             0         36 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bda000 rw-s       4      4      4            0            0             4             0          4 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5bdb000 r--s    2132   2132   2132            0            0          2132             0       2132 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe5df0000 rw-s    5340      0      0            0            0             0             0          0 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe6327000 r--s    2996   2560   2560            0            0          2560             0       2560 /opt/tomcat_sa/C290M5F1A64P_tomcat_G35
    7fffe6614000 r--s  138388  16304  16304            0            0         16304             0      16004 /opt/jdk-9+181/lib/modules
    7fffeed39000 r-xp     100     64     64            0            0            64             0         64 /opt/jdk-9+181/lib/libjimage.so
    7fffeed52000 ---p    2048      0      0            0            0             0             0          0 /opt/jdk-9+181/lib/libjimage.so
    7fffeef52000 r--p       8      8      8            0            0             0             8          8 /opt/jdk-9+181/lib/libjimage.so
    7fffeef54000 rw-p       4      4      4            0            0             0             4          4 /opt/jdk-9+181/lib/libjimage.so
    7ffff77f5000 r-xp    1792   1696   1030         1332            0           364             0       1696 /lib/x86_64-linux-gnu/libc-2.23.so
    7ffff79b5000 ---p    2048      0      0            0            0             0             0          0 /lib/x86_64-linux-gnu/libc-2.23.so
    7ffff7bb5000 r--p      16     16     16            0            0             0            16         16 /lib/x86_64-linux-gnu/libc-2.23.so
    7ffff7bb9000 rw-p       8      8      8            0            0             0             8          8 /lib/x86_64-linux-gnu/libc-2.23.so
    7ffff7bbb000 rw-p      16     16     16            0            0             0            16         16 
    7ffff7bbf000 r-xp      92     92     92            0            0            92             0         92 /opt/jdk-9+181/lib/jli/libjli.so
    7ffff7bd6000 ---p    2044      0      0            0            0             0             0          0 /opt/jdk-9+181/lib/jli/libjli.so
    7ffff7dd5000 r--p       4      4      4            0            0             0             4          4 /opt/jdk-9+181/lib/jli/libjli.so
    7ffff7dd6000 rw-p       4      4      4            0            0             0             4          4 /opt/jdk-9+181/lib/jli/libjli.so
                      ======= ====== ====== ============ ============ ============= ============= ========== 
                      2722488 186084 185240         1684            0         58660        125740     183452 KB 

docker run -v /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples:/examples -p 8091:8080 -i --rm -m 500m cds_demo_oj9:latest /examples/tomcat_measure.sh 11 "-Xquickstart -Xmx64m -Xms64m -Xscmx128m -Xshareclasses:cacheDir=/opt/tomcat_sa,name=tomcat,noaot,nojitdata,verbose -Xnoaot"

(18654+18884+18887+18697+17852+18508+19411+19153+18242+18518)/10
18680

docker run -v /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples:/examples -p 8091:8080 -i --rm -m 500m cds_demo_oj9:latest /examples/tomcat_measure.sh 11 "-Xquickstart -Xmx64m -Xms64m -Xscmx128m -Xshareclasses:none -Xnoaot"

(19250+18684+18427+18868+18501+18133+18339+17942+18473+19185)/10
18580


cat /sys/fs/cgroup/memory/docker/72ea9bf5ec4bb653ed42378099b2cdbef723f204d62222e3cb9705728d58702a/memory.stat

curl -x-unix-socket /var/run/docker.sock http://docker/containers/72ea9bf5ec4b/stats?stream=false

docker stats -x-no-stream
CONTAINER           CPU %               MEM USAGE / LIMIT   MEM %               NET I/O             BLOCK I/O           PIDS
72ea9bf5ec4b        0.94%               215.1MiB / 500MiB   43.01%              427kB / 6.92kB      868kB / 840kB       0

"-Xquickstart -Xmx64m -Xms64m -Xscmx128m -Xshareclasses:cacheDir=/tmp/xxx,name=tomcat,noaot,nojitdata,verbose -Xnoaot"

Create OpenJ9 jimage:
=====================
/share/software/Java/openJ9_jdk9-b181/bin/jlink -x-module-path /share/software/Java/openJ9_jdk9-b181/jmods -x-add-modules java.instrument,java.management,java.naming,java.security.jgss,java.sql,java.xml.ws -x-strip-debug -x-compress=2 -x-output /tmp/oj9
mv /tmp/oj9/lib/server /tmp/oj9/lib/j9vm
cp /share/software/Java/openJ9_jdk9-b181/lib/compressedrefs/lib* /tmp/oj9/lib/

simonis@simonis:/tmp$ JAVA_HOME=/share/software/Java/openJ9_jdk9-b181 /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples/tomcat_measure.sh 5 "-Xquickstart -Xmx64m -Xms64m"
19-Feb-2018 11:53:03.824 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 16099 ms
                      2963224 212184 200569 KB 
19-Feb-2018 11:53:22.442 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 16608 ms
                      2948560 199180 189485 KB 
19-Feb-2018 11:53:41.380 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 16531 ms
                      2949080 196952 187257 KB 
19-Feb-2018 11:54:00.408 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 16589 ms
                      2932440 196628 186933 KB 
19-Feb-2018 11:54:19.104 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 16196 ms
                      2932700 196548 186853 KB 
simonis@simonis:/tmp$ JAVA_HOME=/share/software/Java/openJ9_jdk9-b181 /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples/tomcat_measure.sh 5 "-Xquickstart -Xmx64m -Xms64m"
19-Feb-2018 14:18:58.598 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 16784 ms
                      2932176 196832 187094 KB 
19-Feb-2018 14:19:16.927 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 16113 ms
                      2932696 196736 186998 KB 
19-Feb-2018 14:19:36.479 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 16719 ms
                      2948564 200324 190586 KB 
19-Feb-2018 14:19:55.444 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 16763 ms
                      2948564 203256 193628 KB 
19-Feb-2018 14:20:13.889 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 16301 ms
                      2932700 196796 187168 KB 

simonis@simonis:/tmp$ JAVA_HOME=/share/software/Java/openJ9_jdk9-b181 /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples/tomcat_measure.sh 5 "-Xquickstart -Xmx64m -Xms64m -Xscmx256m -Xshareclasses:verbose -Xshareclasses:noaot -Xshareclasses:nojitdata"
19-Feb-2018 14:25:16.751 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 19371 ms
                      3225312 237000 227246 KB 
19-Feb-2018 14:25:33.059 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 14591 ms
                      3206636 225172 215418 KB 
19-Feb-2018 14:25:49.733 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 14296 ms
                      3223544 226944 217306 KB 
19-Feb-2018 14:26:06.749 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 14455 ms
                      3222764 237044 227286 KB 
19-Feb-2018 14:26:21.943 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 13592 ms
                      3206640 225888 216137 KB 
simonis@simonis:/tmp$ JAVA_HOME=/share/software/Java/openJ9_jdk9-b181 /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples/tomcat_measure.sh 5 "-Xquickstart -Xmx64m -Xms64m -Xscmx256m -Xshareclasses:verbose -Xshareclasses:noaot -Xshareclasses:nojitdata"
19-Feb-2018 14:26:49.003 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 13686 ms
                      3206636 226688 217050 KB 
19-Feb-2018 14:27:05.188 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 13702 ms
                      3206636 227920 218184 KB 
19-Feb-2018 14:27:21.027 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 13482 ms
                      3206636 230304 220691 KB 
19-Feb-2018 14:27:37.104 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 13646 ms
                      3206640 229184 219525 KB 
19-Feb-2018 14:27:53.062 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 13517 ms
                      3207160 231864 222213 KB 
simonis@simonis:/tmp$ JAVA_HOME=/share/software/Java/openJ9_jdk9-b181 /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples/tomcat_measure.sh 5 "-Xquickstart -Xmx64m -Xms64m -Xscmx256m -Xshareclasses:verbose -Xshareclasses:noaot -Xshareclasses:nojitdata"
19-Feb-2018 14:29:30.032 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 13798 ms
                      3206636 233044 223311 KB 
19-Feb-2018 14:29:46.330 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 13784 ms
                      3223020 243312 233674 KB 
19-Feb-2018 14:30:02.132 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 13606 ms
                      3223020 244496 234837 KB 
19-Feb-2018 14:30:17.984 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 13362 ms
                      3207160 237320 227555 KB 
19-Feb-2018 14:30:34.549 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 14034 ms
                      3222764 239712 229968 KB 

simonis@simonis:/tmp$ JAVA_HOME=/share/software/Java/openJ9_jdk9-b181 /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples/tomcat_measure.sh 5 "-Xquickstart -Xmx64m -Xms64m -Xscmx256m -Xshareclasses:verbose -Xshareclasses:noaot -Xshareclasses:nojitdata -Xnoaot"
19-Feb-2018 14:36:24.340 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 16621 ms
                      3203052 231264 221643 KB 
19-Feb-2018 14:36:43.364 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 16409 ms
                      3219436 241256 231635 KB 
19-Feb-2018 14:37:02.522 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 16651 ms
                      3219436 232380 222759 KB 
19-Feb-2018 14:37:21.444 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 16566 ms
                      3219436 233212 223591 KB 
19-Feb-2018 14:37:40.325 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 16518 ms
                      3234360 235804 224252 KB 
simonis@simonis:/tmp$ JAVA_HOME=/share/software/Java/openJ9_jdk9-b181 /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples/tomcat_measure.sh 5 "-Xquickstart -Xmx64m -Xms64m -Xscmx256m -Xshareclasses:verbose -Xshareclasses:noaot -Xshareclasses:nojitdata -Xnoaot"
19-Feb-2018 14:38:12.367 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 16644 ms
                      3219436 236060 226447 KB 
19-Feb-2018 14:38:31.562 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 16726 ms
                      3218916 241380 231759 KB 
19-Feb-2018 14:38:50.429 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 16718 ms
                      3202532 235012 225399 KB 
19-Feb-2018 14:39:09.394 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 16766 ms
                      3217456 237232 225680 KB 
19-Feb-2018 14:39:28.338 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 16745 ms
                      3204076 238464 228843 KB 

Skipping java.lang.invoke.BoundMethodHandle$Species_LII from __JVM_DefineClass__ - reason: dynamically generated class
Skipping jdk.internal.reflect.GeneratedMethodAccessor1 from __JVM_DefineClass__ - reason: dynamically generated class
Skipping com.sun.proxy.$Proxy0 from __JVM_DefineClass__ - reason: dynamically generated class

Skipping org.slf4j.Logger from /share/software/Java/apache-tomcat-9.0.2/webapps/ngrinder-controller-3.4.1/WEB-INF/lib/slf4j-api-1.6.4.jar - reason: class is pre 1.5

Skipping org.ngrinder.infra.spring.Redirect404DispatcherServlet from /share/software/Java/apache-tomcat-9.0.2/webapps/ngrinder-controller-3.4.1/WEB-INF/classes/ - reason: loaded from class file (try '-Dio.simonis.cl4cds.dumpFromClassFile=true')

Skipping org.slf4j.impl.StaticLoggerBinder from /share/software/Java/apache-tomcat-9.0.2/webapps/ngrinder-controller-3.4.1/WEB-INF/lib/logback-classic-1.0.0.jar - reason: failed dependencies

$ /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples/tomcat_measure.sh 5
16-Feb-2018 14:38:34.851 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 18840 ms
                      5989256 572544 563985 KB 
16-Feb-2018 14:39:16.051 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 19467 ms
                      6002124 599876 589484 KB 
16-Feb-2018 14:39:55.655 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 18411 ms
                      5989256 600472 592014 KB 
16-Feb-2018 14:40:35.948 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 18142 ms
                      5991312 622492 613929 KB 
16-Feb-2018 14:41:17.925 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 19419 ms
                      5985144 665980 657421 KB 
16-Feb-2018 14:43:02.200 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 18407 ms
                      5990280 627868 619305 KB 
16-Feb-2018 14:43:43.513 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 19007 ms
                      5988228 625600 617037 KB 
16-Feb-2018 14:44:24.130 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 19071 ms
                      5989256 636224 627665 KB 
16-Feb-2018 14:45:04.853 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 19093 ms
                      6004180 676396 666004 KB 
16-Feb-2018 14:45:44.603 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 18317 ms
                      6006236 560472 550080 KB 

$ /c/Users/D046063/public_html/hotspot/JBreak2018/git/CDS/examples/tomcat_measure.sh 5 "-Xshare:on -XX:+UseAppCDS -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/tmp/tomcat_cl4cds.jsa"
16-Feb-2018 14:50:45.985 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 17953 ms
                      6043244 623932 615501 KB 
16-Feb-2018 14:51:26.752 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 18501 ms
                      6044272 658360 649929 KB 
16-Feb-2018 14:52:06.598 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 17723 ms
                      6045300 573684 565253 KB 
16-Feb-2018 14:52:46.966 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 17462 ms
                      6045300 619712 611281 KB 
16-Feb-2018 14:53:27.908 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 17738 ms
                      6044272 628384 619953 KB 


pmap - - read-rc-from=/c/Users/D046063/public_html/hotspot/FOSDEM2018/git/examples/pmap_slides.rc `pgrep -f tomcat`| less


CATALINA_OPTS="-Djava.security.edg=file:/dev/./urandom" $CATALINA_HOME/bin/catalina.sh start

16-Feb-2018 11:04:09.878 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 19368 ms
16-Feb-2018 11:09:11.988 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 19600 ms

         Address Perm    Size    Rss    Pss Mapping
                      5996964 642776 638454 KB
                      5989768 578628 574310 KB 

</span>
        </section>


        <section class="demo">

<!--

  // A resolved constantPool entry will contain a Klass*, otherwise a Symbol*.

SymbolTable (contains all Symbols)

StringTable (contains all interned Strings)

oop ConstantPool::string_at_impl(const constantPoolHandle& this_cp, int which, int obj_index, TRAPS) {
  // If the string has already been interned, this entry will be non-null
  oop str = this_cp->resolved_references()->obj_at(obj_index);
  assert(str != Universe::the_null_sentinel(), "");
  if (str != NULL) return str;
  Symbol* sym = this_cp->unresolved_string_at(which);
  str = StringTable::intern(sym, CHECK_(NULL));
  this_cp->string_at_put(which, obj_index, str);
  assert(java_lang_String::is_instance(str), "must be string");
  return str;
}

StringTable::intern(Symbol *, Thread *) : oop - /jdk-hs/share/classfile/stringTable.cpp
	CompilerRuntime::resolve_string_by_symbol(JavaThread *, void *, const char *) : void - /jdk-hs/share/jvmci/compilerRuntime.cpp
	ConstantPool::string_at_impl(const constantPoolHandle &, int, int, Thread *) : oop - /jdk-hs/share/oops/constantPool.cpp
		ConstantPool::resolve_class_constants(Thread *) : void - /jdk-hs/share/oops/constantPool.cpp
		ConstantPool::resolve_constant_at_impl(const constantPoolHandle &, int, int, bool *, Thread *) : oop - /jdk-hs/share/oops/constantPool.cpp
			ConstantPool::find_cached_constant_at(int, bool &, Thread *) : oop - /jdk-hs/share/oops/constantPool.hpp
			ConstantPool::resolve_cached_constant_at(int, Thread *) : oop - /jdk-hs/share/oops/constantPool.hpp
				Bytecode_loadconstant::resolve_constant(Thread *) : oop - /jdk-hs/share/interpreter/bytecode.cpp
					InterpreterRuntime::resolve_ldc(JavaThread *, enum Bytecodes::Code) : void - /jdk-hs/share/interpreter/interpreterRuntime.cpp
						TemplateTable::condy_helper(Label &) : void - /jdk-hs/cpu/x86/templateTable_x86.cpp
						TemplateTable::fast_aldc(bool) : void - /jdk-hs/cpu/x86/templateTable_x86.cpp
							TemplateTable::initialize() : void - /jdk-hs/share/interpreter/templateTable.cpp (2 matches)
					Runtime1::patch_code(JavaThread *, enum Runtime1::StubID) : void - /jdk-hs/share/c1/c1_Runtime1.cpp
			ConstantPool::resolve_constant_at(int, Thread *) : oop - /jdk-hs/share/oops/constantPool.hpp
				Bytecode_loadconstant::resolve_constant(Thread *) : oop - /jdk-hs/share/interpreter/bytecode.cpp
					InterpreterRuntime::resolve_ldc(JavaThread *, enum Bytecodes::Code) : void - /jdk-hs/share/interpreter/interpreterRuntime.cpp
						TemplateTable::condy_helper(Label &) : void - /jdk-hs/cpu/x86/templateTable_x86.cpp
						TemplateTable::fast_aldc(bool) : void - /jdk-hs/cpu/x86/templateTable_x86.cpp
					Runtime1::patch_code(JavaThread *, enum Runtime1::StubID) : void - /jdk-hs/share/c1/c1_Runtime1.cpp
				c2v_resolveConstantInPool(JNIEnv *, jobject, jobject, jint) : jobject - /jdk-hs/share/jvmci/jvmciCompilerToVM.cpp
			ConstantPool::resolve_possibly_cached_constant_at(int, Thread *) : oop - /jdk-hs/share/oops/constantPool.hpp
		ConstantPool::string_at(int, int, Thread *) : oop - /jdk-hs/share/oops/constantPool.hpp
	ConstantPool::uncached_string_at(int, Thread *) : oop - /jdk-hs/share/oops/constantPool.cpp
		fieldDescriptor::string_initial_value(Thread *) : oop - /jdk-hs/share/runtime/fieldDescriptor.cpp
			initialize_static_field(fieldDescriptor *, Handle, Thread *) : void - /jdk-hs/share/classfile/javaClasses.cpp
				java_lang_Class::initialize_mirror_fields(Klass *, Handle, Handle, Thread *) : void - /jdk-hs/share/classfile/javaClasses.cpp
					java_lang_Class::create_mirror(Klass *, Handle, Handle, Handle, Thread *) : void - /jdk-hs/share/classfile/javaClasses.cpp
						ArrayKlass::complete_create_array_klass(ArrayKlass *, Klass *, ModuleEntry *, Thread *) : void - /jdk-hs/share/oops/arrayKlass.cpp
						ClassFileParser::fill_instance_klass(InstanceKlass *, bool, Thread *) : void - /jdk-hs/share/classfile/classFileParser.cpp
						java_lang_Class::fixup_mirror(Klass *, Thread *) : void - /jdk-hs/share/classfile/javaClasses.cpp
						Klass::restore_unshareable_info(ClassLoaderData *, Handle, Thread *) : void - /jdk-hs/share/oops/klass.cpp
	java_lang_StackTraceElement::fill_in(Handle, InstanceKlass *, const methodHandle &, int, int, Symbol *, Thread *) : void - /jdk-hs/share/classfile/javaClasses.cpp (4 matches)
	MethodHandles::expand_MemberName(Handle, int, Thread *) : void - /jdk-hs/share/prims/methodHandles.cpp (2 matches)
	Reflection::new_field(fieldDescriptor *, Thread *) : oop - /jdk-hs/share/runtime/reflection.cpp
	Reflection::new_method(const methodHandle &, bool, Thread *) : oop - /jdk-hs/share/runtime/reflection.cpp
	SystemDictionary::find_method_handle_invoker(Klass *, Symbol *, Symbol *, Klass *, Handle *, Handle *, Thread *) : methodHandle - /jdk-hs/share/classfile/systemDictionary.cpp
-->

          <section class="demo">

            <h2>Sharing additional Strings and Symbols</h2>

            <ul>
              <li>Extension of <a href="http://openjdk.java.net/jeps/250">JEP 250: Store Interned Strings in CDS Archives</a></li>
              <li>Added with AppCDS to the OpenJDK</li>
              <li>Documentation is sparse:
                <ul>
                  <li><a href="https://bugs.openjdk.java.net/browse/JDK-8134448">JDK-8134448 Document XX:SharedArchiveConfigFile=&lt;shared_input_file&gt;</a></li>
                  <li>Oracle commercial feature documentation: "<a href='https://docs.oracle.com/javase/9/tools/java.htm#JSWOR-GUID-31503FCE-93D0-4175-9B4F-F6A738B2F4C4'>Sharing a Shared Archive...</a>"</li>
                  </ul>
              </li>
              <li>Have to manually assemble the <code>SharedArchiveConfigFile</code> file from the<br/>
                <code>jcmd &lt;pid&gt; VM.stringtable -verbose</code> and<br/><code>jcmd &lt;pid&gt; VM.symboltable -verbose</code> output</li>
            </ul>
          </section>

          <section class="demo">

            <h2>Create the <code>SharedArchiveConfigFile</code></h2>

            <pre class="big noshadow" style="height:100%; margin: 0;" data-trim="true">
              <code class="terminal" data-trim="true" data-noescape="true" style="height:100%;">
$ jcmd `pgrep -f tomcat` <span class="fragment highlight-current-border" data-fragment-index="1">VM.stringtable</span> -verbose                   
<span class="fragment" data-fragment-index="2">1619:
VERSION: 1.1
<span class="fragment highlight-current-border border-no-bottom" data-fragment-index="9"><span class="fragment highlight-current-border" data-fragment-index="3">23: java.nio.file.attribute</span>                            </span>
<span class="fragment highlight-current-border border-no-bottom-top" data-fragment-index="9">16: javax.swing.plaf                                   </span>
<span class="fragment highlight-current-border border-no-top" data-fragment-index="9">...                                                    </span>
$</span> <span class="fragment" data-fragment-index="4">jcmd `pgrep -f tomcat` VM.symboltable -verbose</span>
<span class="fragment" data-fragment-index="5">1619:
VERSION: 1.0
<span class="fragment highlight-current-border border-no-bottom" data-fragment-index="11"><span class="fragment highlight-current-border" data-fragment-index="6">34 2: Ljava/util/List&lt;Ljava/net/Proxy;&gt;;</span>               </span>
<span class="fragment highlight-current-border border-no-bottom-top" data-fragment-index="11">9 -1: java.net.                                        </span>
<span class="fragment highlight-current-border border-no-top" data-fragment-index="11">...                                                    </span></span>
              </code>
            </pre>

            <pre class="big noshadow fragment" data-fragment-index="7" style="height:100%; margin: 0;" data-trim="true">
              <code class="terminal" data-trim="true" data-noescape="true" style="height:100%;">
$ vi string_symbol.cfg
<span class="fragment" data-fragment-index="8">VERSION: 1.0                                                       
@SECTION: String</span>
<span class="fragment" data-fragment-index="9"><span class="fragment highlight-current-border" data-fragment-index="9">&lt;output of jcmd VM.stringtable&gt;</span></span>
<span class="fragment" data-fragment-index="10">@SECTION: Symbol</span>
<span class="fragment" data-fragment-index="11"><span class="fragment highlight-current-border" data-fragment-index="11">&lt;output of jcmd VM.symboltable&gt;</span></span>
              </code>
            </pre>
          </section>

          <section class="demo">

            <h2>Using the <code>SharedArchiveConfigFile</code></h2>

            <pre class="big noshadow" style="height:100%; margin: 0;" data-trim="true">
              <code class="terminal" data-trim="true" data-noescape="true" style="height:100%;">
$<span class="fragment"> CATALINA_OPTS="<span class="fragment highlight-current-border">-Xshare:dump</span> -XX:+UseAppCDS \
                 <span class="fragment highlight-current-border">-XX:SharedClassListFile=tomcat_cl4cds.cls</span> \
                 -XX:+UnlockDiagnosticVMOptions \
                 <span class="fragment highlight-current-border">-XX:SharedArchiveFile=tomcat_cl4cds.jsa</span>" \
  catalina.sh start
$</span><span class="fragment"> ll tomcat_cl4cds.jsa</span>
<span class="fragment">-r--r----- 1 <span class="fragment highlight-border">102.305.792</span> Feb  3 01:48 tomcat_cl4cds.jsa
$</span><span class="fragment"> CATALINA_OPTS="-Xshare:dump -XX:+UseAppCDS \
                 -XX:SharedClassListFile=tomcat_cl4cds.cls \
                 <span class="fragment highlight-current-border">-XX:SharedArchiveConfigFile=string_symbol.cfg</span> \
                 -XX:+UnlockDiagnosticVMOptions \
                 -XX:SharedArchiveFile=tomcat_cl4cds.jsa" \
  catalina.sh start
$</span><span class="fragment"> ll tomcat_cl4cds.jsa</span>
<span class="fragment">-r--r----- 1 <span class="fragment highlight-border">106.323.968</span> MÃ¤r  2 13:15 tomcat_cl4cds.jsa</span>
              </code>
            </pre>
          </section>
        </section>


<span style="visibility: hidden;">

JDK-8179302 Pre-resolve constant pool string entries and cache resolved_reference arrays in CDS archive
https://bugs.openjdk.java.net/browse/JDK-8179302

JDK-8134448 Document XX:SharedArchiveConfigFile=shared_input_file
https://bugs.openjdk.java.net/browse/JDK-8134448

JDK-8015086 add interned strings to the shared archive
https://bugs.openjdk.java.net/browse/JDK-8015086

JDK-8059510 Compact symbol table layout inside shared archive
https://bugs.openjdk.java.net/browse/JDK-8059510

http://openjdk.java.net/jeps/250
JDK-8059092 JEP 250: Store Interned Strings in CDS Archives
https://bugs.openjdk.java.net/browse/JDK-8059092

https://docs.oracle.com/javase/9/tools/java.htm#JSWOR-GUID-31503FCE-93D0-4175-9B4F-F6A738B2F4C4



Sharing a Shared Archive Across Multiple Application Processes

You can share the same archive file across multiple applications processes. This reduces memory usage because the archive is memory-mapped into the address space of the processes. The operating system automatically shares the read-only pages across these processes.

The following steps demonstrate how to create a common archive that can be shared by different applications. Only the classes from common.jar are archived in the common.jsa (step 3). Classes from hello.jar and hi.jar are not archived in this particular example because they are not in the -cp path during the archiving step (step 3).

To include classes from hello.jar and hi.jar, the .jar files must be added to the -cp path.

    Create a list of all classes used by the Hello application and another list for the Hi application:

    java -XX:+UnlockCommercialFeatures -XX:DumpLoadedClassList=hello.classlist -XX:+UseAppCDS -cp common.jar:hello.jar Hello

    java -XX:+UnlockCommercialFeatures -XX:DumpLoadedClassList=hi.classlist -XX:+UseAppCDS -cp common.jar:hi.jar Hi

    Create a single list of classes used by all the applications that will share the shared archive file.

    Oracle Solaris, Linux, and OS X:: The following commands combine the files hello.classlist and hi.classlist into one file, common.classlist:

    cat hello.classlist hi.classlist > common.classlist

    Windows: The following commands combine the files hello.classlist and hi.classlist into one file, common.classlist:

    type hello.classlist hi.classlist > common.classlist

    Create a shared archive, named common.jsa, that contains all the classes in common.classlist:

     java -XX:+UnlockCommercialFeatures -Xshare:dump -XX:SharedArchiveFile=common.jsa -XX:+UseAppCDS -XX:SharedClassListFile=common.classlist -cp common.jar:hello.jar:hi.jar

    The value of the -cp parameter is the common class path prefix shared by the Hello and Hi applications.

    Run the Hello and Hi applications with the same shared archive:

     java -XX:+UnlockCommercialFeatures -Xshare:on -XX:SharedArchiveFile=common.jsa -XX:+UseAppCDS -cp common.jar:hello.jar:hi.jar Hello 

    java -XX:+UnlockCommercialFeatures -Xshare:on -XX:SharedArchiveFile=common.jsa -XX:+UseAppCDS -cp common.jar:hello.jar:hi.jar Hi

Specifying Additional Shared Data Added to an Archive File

 -XX:SharedArchiveConfigFile=shared_config_file

The option is used to specify additional shared data added to the archive file. In JDK 9, it supports strings and symbols. The string data and symbol data should be generated by the jcmd tool attaching to a running JVM process. See jcmd.

The following is an example of the string and symbol dumping command in jcmd: 

 jcmd pid VM.stringtable -verbose  
 jcmd pid VM.symboltable -verbose

The following is an example of a configuration file:

VERSION: 1.0
@SECTION: String
7: test123
1: *
8: segments
@SECTION: Symbol
10 -1: linkMethod

In the configuration file example:

    The string entries under @SECTION: String use the following format:

    length: string  

    The @SECTION: Symbol entry uses the following format:

     length refcount: symbol

    The refcount for a shared symbol is always -1.

@SECTION specifies the type of the section that follows it. All data within the section must be the same type that's specified by @SECTION. Different types of data canât be mixed. Multiple separated data sections for the same type specified by different @SECTION are allowed within one shared_config_file .


SharedClassUtil::read_extra_data() in share/classfile/sharedClassUtil.cpp

</span>



        <section class="demo">

          <section class="demo">
            <h2>Memory savings with CDS/AppCDS</h2>

            <div width="100%" style="position: relative; margin: 0 0 0 0px;">
              <div class="" style="position: static; width: 100%">
                <object data="images/TomcatMemoryOJDK_1.svg" type="image/svg+xml"
                        style="width: 90%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="1" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/TomcatMemoryOJDK_2.svg" type="image/svg+xml"
                        style="width: 90%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="2" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/TomcatMemoryOJDK_3.svg" type="image/svg+xml"
                        style="width: 90%;">&nbsp;</object>
              </div>
            </div>
            <div  width="100%" style="font-size: medium; text-align:left;">
              Running tomcat 9.0.2 with ngrinder 3.4.1 on OpenJDK 10 in an Ubuntu 16.04
              Docker container with CDS archive at <code>/opt/tomcat_cl4cds.jsa</code><br/>
              and Address Randomization switched off (i.e. <code>`sudo sh -c "echo 0 > /proc/sys/kernel/randomize_va_space"`</code>)<br/>
              <pre style="box-shadow: none; padding: 0; font-size: initial;">CATALINA_OPTS="-Xint -Xmx64m -Xms64m -XX:+UseG1GC -Djava.security.egd=file:/dev/./urandom
               -XX:+UseAppCDS -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/opt/tomcat_cl4cds.jsa" catalina.sh start</pre>
            </div>
          </section>

          <section class="demo">
            <h2>The HotSpot Footprint/Performance Uncertainty Principle</h2>

            <div width="100%" style="position: relative; margin: 0 0 0 0px;">
              <div class="" style="position: static; width: 100%">
                <object data="images/FootprintPerformance_1.svg" type="image/svg+xml"
                        style="width: 80%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="1" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/FootprintPerformance_2.svg" type="image/svg+xml"
                        style="width: 80%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="2" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/FootprintPerformance_3.svg" type="image/svg+xml"
                        style="width: 80%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="3" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/FootprintPerformance_4.svg" type="image/svg+xml"
                        style="width: 80%;">&nbsp;</object>
              </div>
            </div>
          </section>

        </section>

        <section class="demo">

          <section class="demo">

            <h2>Class representation in the HotSpot VM</h2>

            <div width="100%" style="position: relative; margin: 0 0 0 0px;">
              <div class="" style="position: static; width: 100%">
                <object data="images/CodeCacheMetaspaceHeap_1.svg" type="image/svg+xml"
                        style="width: 90%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="1" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/CodeCacheMetaspaceHeap_2.svg" type="image/svg+xml"
                        style="width: 90%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="2" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/CodeCacheMetaspaceHeap_3.svg" type="image/svg+xml"
                        style="width: 90%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="3" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/CodeCacheMetaspaceHeap_4.svg" type="image/svg+xml"
                        style="width: 90%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="4" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/CodeCacheMetaspaceHeap_5.svg" type="image/svg+xml"
                        style="width: 90%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="5" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/CodeCacheMetaspaceHeap_6.svg" type="image/svg+xml"
                        style="width: 90%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="6" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/CodeCacheMetaspaceHeap_7.svg" type="image/svg+xml"
                        style="width: 90%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="7" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/CodeCacheMetaspaceHeap_8.svg" type="image/svg+xml"
                        style="width: 90%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="8" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/CodeCacheMetaspaceHeap_9.svg" type="image/svg+xml"
                        style="width: 90%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="9" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/CodeCacheMetaspaceHeap_10.svg" type="image/svg+xml"
                        style="width: 90%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="10" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/CodeCacheMetaspaceHeap_11.svg" type="image/svg+xml"
                        style="width: 90%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="11" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/CodeCacheMetaspaceHeap_12.svg" type="image/svg+xml"
                        style="width: 90%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="12" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/CodeCacheMetaspaceHeap_13.svg" type="image/svg+xml"
                        style="width: 90%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="13" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/CodeCacheMetaspaceHeap_14.svg" type="image/svg+xml"
                        style="width: 90%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="14" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/CodeCacheMetaspaceHeap_15.svg" type="image/svg+xml"
                        style="width: 90%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="15" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/CodeCacheMetaspaceHeap_16.svg" type="image/svg+xml"
                        style="width: 90%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="16" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/CodeCacheMetaspaceHeap_17.svg" type="image/svg+xml"
                        style="width: 90%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="17" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/CodeCacheMetaspaceHeap_18.svg" type="image/svg+xml"
                        style="width: 90%;">&nbsp;</object>
              </div>

            </div>
          </section>

          <section class="demo">

            <h2>CDS Details - Create the Archive</h2>

            <pre class="big noshadow" style="height:100%; margin: 0;" data-trim="true">
              <code class="terminal" data-trim="true" data-noescape="true" style="height:100%">
$ java -Xshare:dump<span class="fragment" data-fragment-index="0">
<span class="fragment highlight-current-border" data-fragment-index="1">Allocated shared space: 3221225472 bytes at 0x0000000800000000</span>
<span class="fragment highlight-current-border" data-fragment-index="2">Loading classes to share ...</span> <span class="fragment" data-fragment-index="2">// from JAVA_HOME/lib/classlist</span>
<span class="fragment highlight-current-border" data-fragment-index="3">Rewriting and linking classes ...</span> <span class="fragment" data-fragment-index="3"> // Verification, ...</span>
<span class="fragment highlight-current-border" data-fragment-index="4">Number of classes 1240</span>
<span class="fragment highlight-current-border" data-fragment-index="5">Removing unshareable information ... done.</span>
<span class="fragment highlight-current-border" data-fragment-index="6">Relocating embedded pointers ...</span>
<span class="fragment highlight-current-border border-no-bottom" data-fragment-index="7">Dumping symbol table ...                                </span>
<span class="fragment highlight-current-border border-no-top   " data-fragment-index="7">Dumping String objects to closed archive heap region ...</span>
<span class="fragment highlight-current-border" data-fragment-index="8">Dumping objects to open archive heap region ...</span>
<span class="fragment highlight-current-border" data-fragment-index="9">Removing java_mirror ... done.</span> <span class="fragment" data-fragment-index="8"> // java.lang.Class&lt;?&gt;</span>
mc  space:     21832 [  0,1% ] ... at 0x0000000800000000
<span class="fragment highlight-current-border" data-fragment-index="10">rw  space:   4093816 [ 22,2% ] ... at 0x0000000800006000</span>
<span class="fragment highlight-current-border" data-fragment-index="11">ro  space:   7313320 [ 39,7% ] ... at 0x00000008003ee000</span>
md  space:      6352 [  0,0% ] ... at 0x0000000800ae8000
od  space:   6462536 [ 35,1% ] ... at 0x0000000800aea000
<span class="fragment highlight-current-border border-no-bottom" data-fragment-index="12">st0 space:    458752 [  2,5% ] ... at 0x00000000fff00000</span>
<span class="fragment highlight-current-border border-no-top" data-fragment-index="12">oa0 space:     65536 [  0,4% ] ... at 0x00000000ffe00000</span>
total    :  <span class="fragment highlight-border" data-fragment-index="13">18422144</span> [100.0% ] <span class="fragment" data-fragment-index="12"></span></span>
              </code>
            </pre>

          </section>

          <section class="demo">

            <h2>CDS Details - Memory Sharing</h2>

            <pre class="big noshadow" style="height:100%; margin: 0;" data-trim="true">
              <code class="terminal" data-trim="true" data-noescape="true" style="height:100%;">
$ docker run -p 8080:8080 --rm -m 500m cds_demo_ojdk
<span class="fragment" data-fragment-index="1">$ pmap -XX 1508</span>
<span class="fragment" data-fragment-index="2">1508:   /opt/jdk/bin/java ... org.apache.catalina.startup.Bootstrap start

  Address Perm    Size    Rss Shared_Clean Private_Clean Private_Dirty Mapping
 00400000 r-xp       4      4            0             4             0 java
 <span class="fragment highlight-current-border"                      data-fragment-index="3">fc000000 rw-p   52224  52224            0             0         52224</span> // [Java heap]
 <span class="fragment highlight-current-border border-no-bottom    " data-fragment-index="4">ff300000 rw-p     172    172            0            24           148</span> tomcat_cl4cds.jsa
 <span class="fragment highlight-current-border border-no-bottom-top" data-fragment-index="4">ff400000 rw-p     408    408            0           408             0</span> tomcat_cl4cds.jsa
 <span class="fragment highlight-current-border border-no-top       " data-fragment-index="4">ff500000 rw-p    3072   3072            0          3072             0</span> tomcat_cl4cds.jsa
<span class="fragment highlight-current-border                      " data-fragment-index="5">800000000 rwxp      16     16            0             0            16</span> tomcat_cl4cds.jsa
<span class="fragment highlight-current-border                      " data-fragment-index="6">800004000 rw-p   22340  22340            0          1640         20700</span> tomcat_cl4cds.jsa
<span class="fragment highlight-current-border                      " data-fragment-index="7">8015d5000 r--p   39320  39320            0         39320             0</span> tomcat_cl4cds.jsa
803c3b000 rw-p       8      8            0             0             8 tomcat_cl4cds.jsa
<span class="fragment highlight-current-border                      " data-fragment-index="8">803c3d000 r--p   35840  35840            0         35840             0</span> tomcat_cl4cds.jsa</span>
              </code>
            </pre>
          </section>

          <section class="demo">

            <h2>CDS Details - Memory Sharing</h2>

            <pre class="big noshadow" style="height:100%; margin: 0;" data-trim="true">
              <code class="terminal" data-trim="true" data-noescape="true" style="height:100%;">
$ docker run -p <mark class="border">8090:8080</mark> --rm -m 500m cds_demo_ojdk
$ pmap -XX <mark class="border">1508</mark>
1508:   /opt/jdk/bin/java ... org.apache.catalina.startup.Bootstrap start

  Address Perm    Size    Rss Shared_Clean Private_Clean Private_Dirty Mapping
 00400000 r-xp       4      4            4             0             0 java
 fc000000 rw-p   52224  52224            0             0         52224 // [Java heap]
 ff300000 rw-p     172    172           24             0           148 tomcat_cl4cds.jsa
 ff400000 rw-p     408    408          408             0             0 tomcat_cl4cds.jsa
 ff500000 rw-p    3072   3072         3072             0             0 tomcat_cl4cds.jsa
800000000 rwxp      16     16            0             0            16 tomcat_cl4cds.jsa
800004000 rw-p   22340  22340         1640             0         20700 tomcat_cl4cds.jsa
8015d5000 r--p   39320  39320        39320             0             0 tomcat_cl4cds.jsa
803c3b000 rw-p       8      8            0             0             8 tomcat_cl4cds.jsa
803c3d000 r--p   35840  35840        35840             0             0 tomcat_cl4cds.jsa
              </code>
            </pre>
          </section>

        </section>

        <section>

          <h2>AppCDS - Current Limitations</h2>

          <ul>
            <li>Can't share pre 1.5 classes
              <ul>
                <li><a href="https://bugs.openjdk.java.net/browse/JDK-8202556">8202556: Support pre-1.5 classes in CDS</a></li>
              </ul>
            </li>
            <li>Can't share plain classes loaded from files/directories</li>
            <li>Can't share classes from module path</li>
            <li>Can't share dynamically generated classes</li>
            <li>Can't share classes modified by the class loader</li>
            <li>Classes loaded by several class loaders can only be shared once</li>
            <li>No bytecode-rewriting (slow interpreter)</li>
          </ul>
        </section>

        <section>
          <section>

            <h2>Enhancements in OpenJDK 11</h2>

            <ul>
              <li>More sharing: <a href="https://bugs.openjdk.java.net/browse/JDK-8194759">8194759: Support caching class mirror objects</a></li>
              <li>Module path support: <a href="https://bugs.openjdk.java.net/browse/JDK-8194812">8194812: Extend CDS to support the module path</a></li>
              <li>Better usability: <a href="https://bugs.openjdk.java.net/browse/JDK-8193213">8193213: Make the UseAppCDS option obsolete</a></li>
            </ul>

            <h2 style="margin-top: 2ex;" class="fragment" data-fragment-index="1">..and beyond..</h2>

            <ul class="fragment" data-fragment-index="1">
              <li>Dual (i.e. base/application) archive support: <a href="https://bugs.openjdk.java.net/browse/JDK-8202854">8202854: Hybrid archiving</a></li>
              <li>Dynamic (i.e. at runtime) archive generation: <a href="https://bugs.openjdk.java.net/browse/JDK-8202854">8202854: Hybrid archiving</a></li>
              <li>see: <a href="http://mail.openjdk.java.net/pipermail/hotspot-runtime-dev/2018-May/027709.html">hotspot-runtime-dev/2018-May</a></li>
            </ul>
          </section>

          <section>

            <h2><a href="https://bugs.openjdk.java.net/browse/JDK-8194759">8194759: Support caching class mirror objects</a></h2>

            <div width="100%" style="position: relative; margin: 0 0 0 0px;">
              <div class="" style="position: static; width: 100%">
                <object data="images/CodeCacheMetaspaceHeap_18.svg" type="image/svg+xml"
                        style="width: 90%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="1" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/CodeCacheMetaspaceHeap_19.svg" type="image/svg+xml"
                        style="width: 90%;">&nbsp;</object>
              </div>
            </div>
          </section>

          <section>

            <h2><a href="https://bugs.openjdk.java.net/browse/JDK-8194812">8194812: Extend CDS to support the module path</a></h2>

            <table>
              <thead>
                <tr>
                  <th></th>
                  <th><code>-Xshare:dump</code></th>
                  <th><code>-Xshare:{on,auto}</code></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><code>--module-path</code></td>
                  <td style="text-align: center;">Allow</td>
                  <td style="text-align: center;">Allow</td>
                </tr>
                <tr>
                  <td><code>--add-modules</code></td>
                  <td style="text-align: center;">Allow</td>
                  <td style="text-align: center;">Allow</td>
                </tr>
                <tr>
                  <td><code>--module</code></td>
                  <td style="text-align: center;">Allow</td>
                  <td style="text-align: center;">Allow</td>
                </tr>
                <tr>
                  <td><code>--limit-modules</code></td>
                  <td style="text-align: center;">Disallow (exit if specified)</td>
                  <td style="text-align: center;">Allow (disable CDS)</td>
                </tr>
                <tr>
                  <td><code>--patch-module</code></td>
                  <td style="text-align: center;">Disallow (exit if specified)</td>
                  <td style="text-align: center;">Allow (disable CDS)</td>
                </tr>
                <tr>
                  <td><code>--upgrade-module-path</code></td>
                  <td style="text-align: center;">Disallow (exit if specified)</td>
                  <td style="text-align: center;">Allow (disable CDS)</td>
                </tr>
              </tbody>
            </table>

            <p>
              For more details see <a href="http://cr.openjdk.java.net/~ccheung/8194812/write-up/module-path-design.pdf">module-path-design.pdf</a>
            </p>
          </section>

          <section>

            <h2><a href="https://bugs.openjdk.java.net/browse/JDK-8193213">8193213: Make the UseAppCDS option obsolete</a></h2>

            <ul>
              <li><code>-XX:+UseAppCDS</code> will be enabled by default</li>
              <li style="margin-top: 1ex;">Application classes..
                <ul>
                  <li>..in <code>SharedClassListFile</code> will be written to the archive at dump time</li>
                  <li>..from the archive will be used transparently at run time</li>
                </ul>
              </li>
              <li style="margin-top: 1ex;"><code>-XX:SharedArchiveFile</code> becomes a product flag
                <ul>
                  <li>No need to specify <code>-XX:+UnlockDiagnosticVMOptions</code> any more</li>
                </ul>
              </li>
            </ul>
          </section>
        </section>

        <section>

          <section>
            <h2>Class Data Sharing in IBM J9 / Eclipse OpenJ9</h2>

            <ul>
              <li>Introduced in <a href="https://www.ibm.com/support/knowledgecenter/en/SSYKE2_6.0.0/com.ibm.java.doc.user.lnx.60/user/shc_overview.html">IBM SDK 6.0</a></li>
              <li>JIT and AOT artifacts can be shared as well!</li>
              <li>Supports custom class loaders through an <a href="https://www.ibm.com/support/knowledgecenter/SSYKE2_9.0.0/com.ibm.java.multiplatform.90.doc/user/adaptingclassloaders.html">API</a>
                <ul>
                  <li>Class loaders extending <code><a href="https://github.com/ibmruntimes/openj9-openjdk-jdk9/blob/openj9/jdk/src/java.base/share/classes/java/net/URLClassLoader.java">URLClassLoader</a></code> work out of the box</li>
                </ul>
              </li>
              <li>Available in <a href="https://www.eclipse.org/openj9/">Eclipse OpenJ9</a></li>
              <li>Highly customizable (<code><a href="https://www.ibm.com/support/knowledgecenter/en/SSYKE2_9.0.0/com.ibm.java.multiplatform.90.doc/user/sharedclassesxoptions.html">-Xshareclasses</a></code>, ..)</li>
            </ul>
          </section>

          <section class="demo">

            <h2>Eclipse OpenJ9 CDS with Tomcat 9 &amp; nGrinder</h2>

            <pre class="big noshadow" style="height:100%; margin: 0;" data-trim="true">
              <code class="terminal" data-trim="true" data-noescape="true" style="height:100%;">
$ CATALINA_OPTS="<span class="fragment highlight-current-border">-Xscmx128m</span> <span class="fragment highlight-current-border">-Xshareclasses</span>:<span class="fragment highlight-current-border">cacheDir=/tmp/tomcat</span>,<span class="fragment highlight-current-border">name=tomcat</span>,verbose" \
  catalina.sh start
<span class="fragment">[-Xshareclasses persistent cache enabled]
JVMSHRC236I Created shared classes persistent cache tomcat
JVMSHRC246I Attached shared classes persistent cache tomcat
JVMSHRC168I Total shared class bytes read=3738038. Total bytes stored=47196956
$</span><span class="fragment"> ls -l /tmp/tomcat
-rw-r----- 1 simonis simonis 134217728 Feb 23 17:44 C290M5F1A64P_tomcat_G35
$</span><span class="fragment"> java -Xshareclasses:cacheDir=/tmp/tomcat,name=tomcat,<span class="fragment highlight-current-border">printStats</span></span>
<span class="fragment">Current statistics for cache "tomcat":
cache size                           = 134_217_120
free bytes                           =  80_991_164
ROMClass bytes                       =  <span class="fragment highlight-current-border">28_017_248</span>
AOT bytes                            =  <span class="fragment highlight-current-border">13_330_160</span>
JIT data bytes                       =      <span class="fragment highlight-current-border">99_072</span>
Data bytes                           =     363_936
Metadata bytes                       =     70_8596
# ROMClasses                         =      11_589
# AOT Methods                        =       6_329
Cache is 39% full</span>
              </code>
            </pre>
          </section>


          <section class="demo">
            <h2>Memory savings with CDS/AppCDS</h2>

            <div width="100%" style="position: relative; margin: 0 0 0 0px;">
              <div class="" style="position: static; width: 100%">
                <object data="images/TomcatMemoryOJ9_1.svg" type="image/svg+xml"
                        style="width: 90%;">&nbsp;</object>
              </div>
              <div class="fragment" data-fragment-index="1" style="position: absolute; left: 0; top: 0; width: 100%">
                <object data="images/TomcatMemoryOJ9_2.svg" type="image/svg+xml"
                        style="width: 90%;">&nbsp;</object>
              </div>
            </div>
            <div  width="100%" style="font-size: medium; text-align:left; margin: 20px auto 0;">
              tomcat 9.0.2 &amp; ngrinder 3.4.1 on OpenJDK 10 / OpenJ9 9 in an Ubuntu 16.04
              Docker container with CDS archives at <code>/opt/tomcat_cl4cds.jsa</code> &amp; <code>/opt/tomcat/C290M5F1A64P_tomcat_G35</code><br/>
              and Address Randomization switched off (i.e. <code>`sudo sh -c "echo 0 > /proc/sys/kernel/randomize_va_space"`</code>)<br/>
              <pre style="box-shadow: none; padding: 0; margin: 20px auto 0; font-size: initial;">CATALINA_OPTS="-Xint -Xmx64m -Xms64m -XX:+UseG1GC -Djava.security.egd=file:/dev/./urandom
               -XX:+UseAppCDS -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/opt/tomcat_cl4cds.jsa" catalina.sh start</pre>
              <pre class="fragment" data-fragment-index="1" style="box-shadow: none; padding: 0; font-size: initial;">CATALINA_OPTS="-Xint -Xmx64m -Xms64m -Djava.security.egd=file:/dev/./urandom
               -Xshareclasses:cacheDir=/opt/tomcat,name=tomcat,noaot,nojitdata -Xnoaot -Xnojit" catalina.sh start</pre>
            </div>
          </section>
        </section>


        <section>

          <h3 style="text-transform: none;"><a href="https://simonis.github.io/GeeCON2018/CDS">https://simonis.github.io/GeeCON2018/CDS</a></h3>

        </section>

<!--

AppCds - Ceavets

- can't share pre 1.5 classes
- can't share dynamically generated classes
- can't share classes loaded from files (only .jar archives)
- can share only one class if loaded by several class loaders
- can't share classes modified by the class loader

- no bytecode-rewriting (slow interpreter)

$ CATALINA_OPTS="-Xshare:on -Xlog:class+load:file=/tmp/tomcat.classtrace" $CATALINA_HOME/bin/catalina.sh start
$ wc /tmp/tomcat.classtrace
  12644   50575 2075264 /tmp/tomcat.classtrace
$ grep "shared objects file" /tmp/tomcat.classtrace | wc
   1156    6936  103052
$ CATALINA_OPTS="-XX:DumpLoadedClassList=/tmp/tomcat.cls" $CATALINA_HOME/bin/catalina.sh start
$ wc /tmp/tomcat.cls
  3261   3261 125647 /tmp/tomcat.cls
$ CATALINA_OPTS="-XX:DumpLoadedClassList=/tmp/tomcat_appcds.cls -XX:+UseAppCDS" $CATALINA_HOME/bin/catalina.sh start
$ wc /tmp/tomcat_appcds.cls
  3520   3520 133431 /tmp/tomcat_appcds.cls

$ CATALINA_OPTS="-Xlog:class+load=debug:file=/tmp/tomcat_debug.classtrace" $CATALINA_HOME/bin/catalina.sh start

[0.009s][info ][class,load] java.lang.Object source: jrt:/java.base
[0.009s][debug][class,load]  klass: 0x0000000100000eb0 super: 0x0000000000000000 loader: [NULL class loader] bytes: 1932 checksum: b0107909
...
[0,213s][info ][class,load] java.sql.Timestamp source: jrt:/java.sql
[0,213s][debug][class,load]  klass: 0x0000000100096c30 super: 0x0000000100091a00 loader: [class loader 0x00007ffff0172600 a 'jdk/internal/loader/ClassLoaders$PlatformClassLoader'{0x000000008af9f628}] bytes: 6804 checksum: 27
...
[0,492s][info ][class,load] org.apache.catalina.Server source: file:/share/software/Java/apache-tomcat-9.0.2/lib/catalina.jar
[0,492s][debug][class,load]  klass: 0x00000001000e6410 super: 0x0000000100000eb0 interfaces: 0x00000001000e6238 loader: [class loader 0x00007ffff0310fb0 a 'java/net/URLClassLoader'{0x000000008aabf5b0}] bytes: 1244 checksum: 

org/apache/catalina/Lifecycle id: 0x00000001000e6238 super: 0x0000000100000eb0 source: catalina.jar
org/apache/catalina/Server id: 0x00000001000e6410 super: 0x0000000100000eb0 interfaces: 0x00000001000e6238 source: catalina.jar

$ CATALINA_OPTS="-Xshare:dump -XX:+UseAppCDS -XX:SharedClassListFile=/tmp/tomcat_cl4cds.cls -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/tmp/tomcat_cl4cds.jsa" $CATALINA_HOME/bin/catalina.sh start

$ CATALINA_OPTS="-Xshare:on -XX:+UseAppCDS -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/tmp/tomcat_cl4cds.jsa -Xlog:class+load:file=/tmp/tomcat_cl4cds.classtrace" $CATALINA_HOME/bin/catalina.sh start
$ wc /tmp/tomcat_cl4cds.classtrace
  12644   69335 1531203 /tmp/tomcat_cl4cds.classtrace
$ grep "shared objects " /tmp/tomcat_cl4cds.classtrace | wc
   9380   56280  963418


ConstantPool::archive_resolved_references(Thread *) : void - /jdk-hs/share/oops/constantPool.cpp
  MetaspaceShared::archive_resolved_constants(Thread *) : void - /jdk-hs/share/memory/metaspaceShared.cpp
    MetaspaceShared::dump_open_archive_heap_objects(GrowableArray<MemRegion> *) : void - /jdk-hs/share/memory/metaspaceShared.cpp
      VM_PopulateDumpSharedSpace::dump_java_heap_objects() : void - /jdk-hs/share/memory/metaspaceShared.cpp
        VM_PopulateDumpSharedSpace::doit() : void - /jdk-hs/share/memory/metaspaceShared.cpp


G1CollectedHeap::alloc_archive_regions(MemRegion *, size_t, bool) : bool - /jdk-hs/share/gc/g1/g1CollectedHeap.cpp
  FileMapInfo::map_heap_data(MemRegion * *, int, int, int *, bool) : bool - /jdk-hs/share/memory/filemap.cpp
    FileMapInfo::map_heap_regions() : void - /jdk-hs/share/memory/filemap.cpp (2 matches)
      MetaspaceShared::initialize_runtime_shared_and_meta_spaces() : void - /jdk-hs/share/memory/metaspaceShared.cpp
        Metaspace::global_initialize() : void - /jdk-hs/share/memory/metaspace.cpp
          universe_init() : jint - /jdk-hs/share/memory/universe.cpp


$ ls -la /share/output-jdk-hs-dbg/images/jdk/lib/server/classes.jsa
 1 simonis simonis 18436096 Feb  2 11:28 /share/output-jdk-hs-dbg/images/jdk/lib/server/classes.jsa

arguments.cpp
=============
#if COMPILER2_OR_JVMCI
  // Shared spaces work fine with other GCs but causes bytecode rewriting
  // to be disabled, which hurts interpreter performance and decreases
  // server performance.  When -server is specified, keep the default off
  // unless it is asked for.  Future work: either add bytecode rewriting
  // at link time, or rewrite bytecodes in non-shared methods.
  if (is_server_compilation_mode_vm() && !DumpSharedSpaces && !RequireSharedSpaces &&
      (FLAG_IS_DEFAULT(UseSharedSpaces) || !UseSharedSpaces)) {
    no_shared_spaces("COMPILER2 default: -Xshare:auto | off, have to manually setup to on.");
  }
#endif

// Null out class_loader_data because we don't share that yet.
set_class_loader_data(NULL);
Klass::remove_unshareable_info() : void - /jdk-hs/share/oops/klass.cpp
  InstanceKlass::remove_unshareable_info() : void - /jdk-hs/share/oops/instanceKlass.cpp (2 matches)
    InstanceKlass::remove_unshareable_info() : void - /jdk-hs/share/oops/instanceKlass.cpp
    remove_unshareable_in_classes() : void - /jdk-hs/share/memory/metaspaceShared.cpp
      VM_PopulateDumpSharedSpace::doit() : void - /jdk-hs/share/memory/metaspaceShared.cpp

Creating and using archive ONLY with same configuration (i.e. CompressedOops mode)

-XX:SharedBaseAddress=0x900000000

rewrite_nofast_bytecode(Method *) : void - /jdk-hs/share/memory/metaspaceShared.cpp
  rewrite_nofast_bytecodes_and_calculate_fingerprints() : void - /jdk-hs/share/memory/metaspaceShared.cpp
    VM_PopulateDumpSharedSpace::doit() : void - /jdk-hs/share/memory/metaspaceShared.cpp
      VM_Operation::evaluate() : void - /jdk-hs/share/runtime/vm_operations.cpp

#0  ClassListParser::load_current_class (this=0x7ffff7fd7960, __the_thread__=0x7ffff001a6f0) at /share/OpenJDK/jdk-hs/src/hotspot/share/classfile/classListParser.cpp:323
#1  0x00007ffff5a89f98 in ClassLoaderExt::load_one_class (parser=0x7ffff7fd7960, __the_thread__=0x7ffff001a6f0) at /share/OpenJDK/jdk-hs/src/hotspot/share/classfile/classLoaderExt.cpp:350
#2  0x00007ffff624699a in MetaspaceShared::preload_classes (class_list_path=0x7ffff000fa70 "TwoLoaders_a.cls", __the_thread__=0x7ffff001a6f0) at /share/OpenJDK/jdk-hs/src/hotspot/share/memory/metaspaceShared.cpp:1615
#3  0x00007ffff62467a6 in MetaspaceShared::preload_and_dump (__the_thread__=0x7ffff001a6f0) at /share/OpenJDK/jdk-hs/src/hotspot/share/memory/metaspaceShared.cpp:1584
#4  0x00007ffff651e8a4 in Threads::create_vm (args=0x7ffff7fd9e20, canTryAgain=0x7ffff7fd9d0b) at /share/OpenJDK/jdk-hs/src/hotspot/share/runtime/thread.cpp:3990
#5  0x00007ffff5f3283c in JNI_CreateJavaVM_inner (vm=0x7ffff7fd9e88, penv=0x7ffff7fd9e90, args=0x7ffff7fd9e20) at /share/OpenJDK/jdk-hs/src/hotspot/share/prims/jni.cpp:3908
#6  0x00007ffff5f32bdd in JNI_CreateJavaVM (vm=0x7ffff7fd9e88, penv=0x7ffff7fd9e90, args=0x7ffff7fd9e20) at /share/OpenJDK/jdk-hs/src/hotspot/share/prims/jni.cpp:4003
#7  0x00007ffff7bcd39a in InitializeJVM (pvm=0x7ffff7fd9e88, penv=0x7ffff7fd9e90, ifn=0x7ffff7fd9ee0) at /share/OpenJDK/jdk-hs/src/java.base/share/native/libjli/java.c:1478
#8  0x00007ffff7bca0e2 in JavaMain (_args=0x7fffffffa9f0) at /share/OpenJDK/jdk-hs/src/java.base/share/native/libjli/java.c:411
#9  0x00007ffff71ca184 in start_thread () from /lib/x86_64-linux-gnu/libpthread.so.0
#10 0x00007ffff78faffd in clone () from /lib/x86_64-linux-gnu/libc.so.6

For all entries without 'source:' tag call "java_system_loader().loadClass()"

For all other entries (with 'source:' tag) call ClassListParser::load_class_from_source(Symbol* class_name, TRAPS)

Use the following command to dump a shared archive:

/share/output-jdk-hs-dbg/images/jdk/bin/java -XX:+UnlockDiagnosticVMOptions -XX:SharedArchiveFile=/tmp/TwoLoaders_a.jsa -XX:+PrintSharedArchiveAndExit -XX:+PrintSharedDictionary -cp simonis.jar io.simonis.TwoLoaders

java_lang_Class::set_klass(oop, Klass *) : void - /jdk-hs/share/classfile/javaClasses.cpp
  InstanceKlass::deallocate_contents(ClassLoaderData *) : void - /jdk-hs/share/oops/instanceKlass.cpp
  java_lang_Class::create_mirror(Klass *, Handle, Handle, Handle, Thread *) : void - /jdk-hs/share/classfile/javaClasses.cpp (2 matches)
    ArrayKlass::complete_create_array_klass(ArrayKlass *, Klass *, ModuleEntry *, Thread *) : void - /jdk-hs/share/oops/arrayKlass.cpp
    ClassFileParser::fill_instance_klass(InstanceKlass *, bool, Thread *) : void - /jdk-hs/share/classfile/classFileParser.cpp
      ClassFileParser::create_instance_klass(bool, Thread *) : InstanceKlass * - /jdk-hs/share/classfile/classFileParser.cpp
        KlassFactory::check_shared_class_file_load_hook(InstanceKlass *, Symbol *, Handle, Handle, Thread *) : InstanceKlass * - /jdk-hs/share/classfile/klassFactory.cpp
          SystemDictionary::load_shared_class(InstanceKlass *, Handle, Handle, Thread *) : InstanceKlass * - /jdk-hs/share/classfile/systemDictionary.cpp
        KlassFactory::create_from_stream(ClassFileStream *, Symbol *, ClassLoaderData *, Handle, const InstanceKlass *, GrowableArray<Handle> *, Thread *) : InstanceKlass * - /jdk-hs/share/classfile/klassFactory.cpp (2 matches)
          ClassLoader::load_class(Symbol *, bool, Thread *) : InstanceKlass * - /jdk-hs/share/classfile/classLoader.cpp
          ClassLoaderExt::load_class(Symbol *, const char *, Thread *) : InstanceKlass * - /jdk-hs/share/classfile/classLoaderExt.cpp
          SystemDictionary::parse_stream(Symbol *, Handle, Handle, ClassFileStream *, const InstanceKlass *, GrowableArray<Handle> *, Thread *) : InstanceKlass * - /jdk-hs/share/classfile/systemDictionary.cpp
          SystemDictionary::resolve_from_stream(Symbol *, Handle, Handle, ClassFileStream *, Thread *) : InstanceKlass * - /jdk-hs/share/classfile/systemDictionary.cpp
    java_lang_Class::fixup_mirror(Klass *, Thread *) : void - /jdk-hs/share/classfile/javaClasses.cpp
    Klass::restore_unshareable_info(ClassLoaderData *, Handle, Thread *) : void - /jdk-hs/share/oops/klass.cpp
      ArrayKlass::restore_unshareable_info(ClassLoaderData *, Handle, Thread *) : void - /jdk-hs/share/oops/arrayKlass.cpp
      initialize_basic_type_klass(Klass *, Thread *) : void - /jdk-hs/share/memory/universe.cpp
      InstanceKlass::restore_unshareable_info(ClassLoaderData *, Handle, Thread *) : void - /jdk-hs/share/oops/instanceKlass.cpp (2 matches)
        initialize_basic_type_klass(Klass *, Thread *) : void - /jdk-hs/share/memory/universe.cpp
        InstanceKlass::restore_unshareable_info(ClassLoaderData *, Handle, Thread *) : void - /jdk-hs/share/oops/instanceKlass.cpp
        SystemDictionary::load_shared_class(InstanceKlass *, Handle, Handle, Thread *) : InstanceKlass * - /jdk-hs/share/classfile/systemDictionary.cpp
          SystemDictionary::load_shared_class(Symbol *, Handle, Thread *) : InstanceKlass * - /jdk-hs/share/classfile/systemDictionary.cpp
          SystemDictionaryShared::acquire_class_for_current_thread(InstanceKlass *, Handle, Handle, Thread *) : InstanceKlass * - /jdk-hs/share/classfile/systemDictionaryShared.cpp
          SystemDictionaryShared::load_shared_class_for_builtin_loader(Symbol *, Handle, Thread *) : InstanceKlass * - /jdk-hs/share/classfile/systemDictionaryShared.cpp
            SystemDictionaryShared::find_or_load_shared_class(Symbol *, Handle, Thread *) : InstanceKlass * - /jdk-hs/share/classfile/systemDictionaryShared.cpp


// There can be only 1 class with this name for unregistered loaders.
SharedDictionary::get_entry_for_unregistered_loader(const Symbol *, int, int) : SharedDictionaryEntry * - /jdk-hs/share/classfile/systemDictionaryShared.cpp
  SharedDictionary::class_exists_for_unregistered_loader(const Symbol *) : bool - /jdk-hs/share/classfile/systemDictionaryShared.hpp
    SystemDictionaryShared::lookup_from_stream(const Symbol *, Handle, Handle, const ClassFileStream *, Thread *) : InstanceKlass * - /jdk-hs/share/classfile/systemDictionaryShared.cpp
  SharedDictionary::find_class_for_unregistered_loader(const Symbol *, int, int) : Klass * - /jdk-hs/share/classfile/systemDictionaryShared.cpp
    SystemDictionaryShared::lookup_from_stream(const Symbol *, Handle, Handle, const ClassFileStream *, Thread *) : InstanceKlass * - /jdk-hs/share/classfile/systemDictionaryShared.cpp
      SystemDictionary::resolve_from_stream(Symbol *, Handle, Handle, ClassFileStream *, Thread *) : InstanceKlass * - /jdk-hs/share/classfile/systemDictionary.cpp
        jni_DefineClass(JNIEnv *, const char *, jobject, const jbyte *, jsize) : jclass - /jdk-hs/share/prims/jni.cpp
          {init jni_NativeInterface}() : JNINativeInterface_ - /jdk-hs/share/prims/jni.cpp
        jvm_define_class_common(JNIEnv *, const char *, jobject, const jbyte *, jsize, jobject, const char *, Thread *) : jclass - /jdk-hs/share/prims/jvm.cpp
          JVM_DefineClass(JNIEnv *, const char *, jobject, const jbyte *, jsize, jobject) : jclass - /jdk-hs/share/prims/jvm.cpp
            Unsafe_DefineClass_impl(JNIEnv *, jstring, jbyteArray, int, int, jobject, jobject) : jclass - /jdk-hs/share/prims/unsafe.cpp
              Unsafe_DefineClass0(JNIEnv *, jobject, jstring, jbyteArray, int, int, jobject, jobject) : jclass - /jdk-hs/share/prims/unsafe.cpp
                {init jdk_internal_misc_Unsafe_methods}() : JNINativeMethod [71] - /jdk-hs/share/prims/unsafe.cpp
          JVM_DefineClassWithSource(JNIEnv *, const char *, jobject, const jbyte *, jsize, jobject, const char *) : jclass - /jdk-hs/share/prims/jvm.cpp


Dictionary::add_entry(int, DictionaryEntry *) : void - /jdk-hs/share/classfile/dictionary.hpp
  CombineDictionariesClosure::do_cld(ClassLoaderData *) : void - /jdk-hs/share/classfile/systemDictionary.cpp
  Dictionary::add_klass(unsigned int, Symbol *, InstanceKlass *) : void - /jdk-hs/share/classfile/dictionary.cpp
    SystemDictionary::update_dictionary(unsigned int, int, unsigned int, InstanceKlass *, Handle, Thread *) : void - /jdk-hs/share/classfile/systemDictionary.cpp
  SharedDictionary::add_non_builtin_klass(const Symbol *, ClassLoaderData *, InstanceKlass *) : bool - /jdk-hs/share/classfile/systemDictionaryShared.cpp
    SystemDictionaryShared::add_non_builtin_klass(Symbol *, ClassLoaderData *, InstanceKlass *, Thread *) : bool - /jdk-hs/share/classfile/systemDictionaryShared.cpp
      // if (!SystemDictionaryShared::add_non_builtin_klass(class_name, ClassLoaderData::the_null_class_loader_data(),...)
      // This adds the loaded class to the boot_loader_dictionary with a class loader set to the null (boot) class loader (altough the class was loaded by a custom class loader!!!)
      ClassListParser::load_class_from_source(Symbol *, Thread *) : InstanceKlass * - /jdk-hs/share/classfile/classListParser.cpp
        ClassListParser::load_current_class(Thread *) : Klass * - /jdk-hs/share/classfile/classListParser.cpp
          ClassLoaderExt::load_one_class(ClassListParser *, Thread *) : Klass * - /jdk-hs/share/classfile/classLoaderExt.cpp
            MetaspaceShared::preload_classes(const char *, Thread *) : int - /jdk-hs/share/memory/metaspaceShared.cpp
              MetaspaceShared::preload_and_dump(Thread *) : void - /jdk-hs/share/memory/metaspaceShared.cpp (2 matches)


At runtime:

SystemDictionaryShared::acquire_class_for_current_thread(InstanceKlass *, Handle, Handle, Thread *) : InstanceKlass * - /jdk-hs/share/classfile/systemDictionaryShared.cpp
    if (ik->class_loader_data() != NULL) {
      //    ik is already loaded (by this loader or by a different loader)
      // or ik is being loaded by a different thread (by this loader or by a different loader)
      return NULL;
    }
SharedDictionary::find_class_for_unregistered_loader(const Symbol *, int, int) : Klass * - /jdk-hs/share/classfile/systemDictionaryShared.cpp
  SystemDictionaryShared::lookup_from_stream(const Symbol *, Handle, Handle, const ClassFileStream *, Thread *) : InstanceKlass * - /jdk-hs/share/classfile/systemDictionaryShared.cpp
    SystemDictionary::resolve_from_stream(Symbol *, Handle, Handle, ClassFileStream *, Thread *) : InstanceKlass * - /jdk-hs/share/classfile/systemDictionary.cpp
      jni_DefineClass(JNIEnv *, const char *, jobject, const jbyte *, jsize) : jclass - /jdk-hs/share/prims/jni.cpp
      jvm_define_class_common(JNIEnv *, const char *, jobject, const jbyte *, jsize, jobject, const char *, Thread *) : jclass - /jdk-hs/share/prims/jvm.cpp
        JVM_DefineClass(JNIEnv *, const char *, jobject, const jbyte *, jsize, jobject) : jclass - /jdk-hs/share/prims/jvm.cpp
        JVM_DefineClassWithSource(JNIEnv *, const char *, jobject, const jbyte *, jsize, jobject, const char *) : jclass - /jdk-hs/share/prims/jvm.cpp


TODO:

InstanceKlass* ClassListParser::load_class_from_source(Symbol* class_name, TRAPS) {

We shoould probably check for other 'prohibited packages' as well (and before we load the klass!):

  InstanceKlass* k = ClassLoaderExt::load_class(class_name, _source, THREAD);

  if (strncmp(_class_name, "java/", 5) == 0) {
    log_info(cds)("Prohibited package for non-bootstrap classes: %s.class from %s",
          _class_name, _source);
    return NULL;
  }

-->

      </div>
    </div>

    <script src="reveal.js/lib/js/head.min.js"></script>
    <script src="reveal.js/js/reveal.js"></script>

    <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        //width: 1024,
        //height: 768,
        //width: 1280,
        //height: 720,
        width: 1366,
        height: 768,
        //width: 1920,
        //height: 1080,
        //margin: 0.1, // Old setting which was used in the reveal.js version used for the JET2015 presentation
        controls: true,
        progress: true,
        history: true,
        center: true,
        slideNumber: true,

        transition: 'none', // none/fade/slide/convex/concave/zoom

        // Optional reveal.js plugins
        dependencies: [
          { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'reveal.js/plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() {

hljs.registerLanguage('terminal', function(hljs) {
  return {
    contains: [
      hljs.C_LINE_COMMENT_MODE,
      {
        className: 'title',
        lexemes: /[$()>_a-zA-Z0-9]+/,
        keywords: "$ (gdb) hsdb>",
        begin: /^\$ |\(gdb\)|hsdb> /,
        end: /[^\\]\n/,
	contains: [
          hljs.COMMENT('//', '$', { endsParent: true })
	]
      }
    ]
  }
});

hljs.initHighlightingOnLoad(); } },
          { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
          { src: 'reveal.js/plugin/notes/notes.js', async: true }
        ]
      });

      //Reveal.configure({ slideNumber: true });
    </script>

  </body>
</html>

<!--  LocalWords:  HotSpot VM eval defun setq inputStr substring kbd
 -->
<!--  LocalWords:  resultStr concat vhs CDS AppCDS nGrinder OpenJDK
 -->
<!--  LocalWords:  JEP classListParser cpp pre bytecode MemRegion GCs
 -->
<!--  LocalWords:  bool init jint simonis JVMCI bytecodes vm Xshare
 -->
<!--  LocalWords:  DumpSharedSpaces RequireSharedSpaces endif nofast
 -->
<!--  LocalWords:  UseSharedSpaces unshareable CompressedOops ffff fd
 -->
<!--  LocalWords:  SharedBaseAddress TwoLoaders cls args canTryAgain
 -->
<!--  LocalWords:  JNI CreateJavaVM penv bdd bcd InitializeJVM pvm ee
 -->
<!--  LocalWords:  ifn bca JavaMain fffffffa faffd loadClass cp oop
 -->
<!--  LocalWords:  UnlockDiagnosticVMOptions SharedArchiveFile Klass
 -->
<!--  LocalWords:  PrintSharedArchiveAndExit PrintSharedDictionary ik
 -->
<!--  LocalWords:  ClassLoaderData ArrayKlass ModuleEntry const klass
 -->
<!--  LocalWords:  InstanceKlass ClassFileStream GrowableArray jni GC
 -->
<!--  LocalWords:  SharedDictionaryEntry DefineClass JNIEnv jobject
 -->
<!--  LocalWords:  jbyte jsize jclass NativeInterface jvm impl jdk RW
 -->
<!--  LocalWords:  JNINativeInterface jstring jbyteArray altough TODO
 -->
<!--  LocalWords:  JNINativeMethod DefineClassWithSource runtime cds
 -->
<!--  LocalWords:  DictionaryEntry shoould strncmp JRuby startup ojdk
 -->
<!--  LocalWords:  TieredStopAtLevel CICompilerCount Xmx Xms Xlog RO
 -->
<!--  LocalWords:  UseG UseAppCDS SharedClassListFile ConstMethods mc
 -->
<!--  LocalWords:  metaspace rw ro md od oa jcmd pgrep stringtable oj
 -->
<!--  LocalWords:  symboltable cfg SharedArchiveConfigFile OpenJ BCI
 -->
<!--  LocalWords:  Xquickstart Xscmx Xshareclasses cacheDir noaot cr
 -->
<!--  LocalWords:  nojitdata Xnoaot printStats Xnolinenumbers FFFA kB
 -->
<!--  LocalWords:  Classpaths FFFAC softmx ROMClass AOT JIT Metadata
 -->
<!--  LocalWords:  ROMClasses Xint MEM PIDS fbd MiB dff bd PID Rss xp
 -->
<!--  LocalWords:  classpath Pss fc rwxp adb dler pkgs jsa ec Xnojit
 -->
<!--  LocalWords:  bb Djava protoc Dignore endo rsed dirs fbff fffde
 -->
<!--  LocalWords:  fffe ba bab bac bbc bbd bbe bbf bcb bda bdb df bbb
 -->
<!--  LocalWords:  fffeed fffeef Dcatalina unix jimage sql mv pmap rc
 -->
<!--  LocalWords:  str sym JavaThread constantPoolHandle enum JSWOR
 -->
<!--  LocalWords:  resolveConstantInPool fieldDescriptor methodHandle
 -->
<!--  LocalWords:  GUID FCE UnlockCommercialFeatures classlist config
 -->
<!--  LocalWords:  DumpLoadedClassList Solaris pid linkMethod SDK API
 -->
<!--  LocalWords:  refcount ngrinder catalina Intruduced
 -->
